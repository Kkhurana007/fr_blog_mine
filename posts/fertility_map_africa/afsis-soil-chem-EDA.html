<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-06-15">
<meta name="description" content="Elemental soil fertility analysis for african continent">

<title>Homepage - Tools - Soil Chemistry Dataset</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-YSR47ZM5Y0"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-YSR47ZM5Y0', { 'anonymize_ip': true});
</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Homepage - Tools - Soil Chemistry Dataset">
<meta name="twitter:description" content="Elemental soil fertility analysis for african continent">
<meta name="twitter:image" content="https://ilovesoils.com/posts/fertility_map_africa/afsis-soil-chem-EDA_files/figure-html/cell-13-output-1.jpeg">
<meta name="twitter:creator" content="@kunalkhurana007">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Homepage</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Kunal Khurana</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-posts" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Posts</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-posts">    
        <li>
    <a class="dropdown-item" href="../../posts/index.html" rel="" target="">
 <span class="dropdown-text">All posts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/en.html" rel="" target="">
 <span class="dropdown-text">English</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../posts/fr.html" rel="" target="">
 <span class="dropdown-text">Français</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Kkhurana007/fr_blog_mine" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/kunalkhurana007" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Tools - Soil Chemistry Dataset</h1>
            <p class="subtitle lead">Exploratory analysis</p>
                  <div>
        <div class="description">
          Elemental soil fertility analysis for african continent
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Soils</div>
                <div class="quarto-category">Data Analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 15, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#prerequisities-and-import-libraries" id="toc-prerequisities-and-import-libraries" class="nav-link active" data-scroll-target="#prerequisities-and-import-libraries">1.1 Prerequisities and import libraries</a></li>
  <li><a href="#downloading-the-soil-chemistry-dataset-from-aws" id="toc-downloading-the-soil-chemistry-dataset-from-aws" class="nav-link" data-scroll-target="#downloading-the-soil-chemistry-dataset-from-aws">1.2 Downloading the Soil Chemistry Dataset from AWS</a></li>
  <li><a href="#loading-opus-spectra" id="toc-loading-opus-spectra" class="nav-link" data-scroll-target="#loading-opus-spectra">1.3 Loading OPUS spectra</a></li>
  <li><a href="#geographical-references" id="toc-geographical-references" class="nav-link" data-scroll-target="#geographical-references">2. Geographical references</a>
  <ul class="collapse">
  <li><a href="#dataframes-exploration" id="toc-dataframes-exploration" class="nav-link" data-scroll-target="#dataframes-exploration">2.1 Dataframes exploration</a></li>
  </ul></li>
  <li><a href="#dry-chemistry" id="toc-dry-chemistry" class="nav-link" data-scroll-target="#dry-chemistry">3. Dry Chemistry</a>
  <ul class="collapse">
  <li><a href="#x-ray-fluorescence-xrf-elemental-analysis" id="toc-x-ray-fluorescence-xrf-elemental-analysis" class="nav-link" data-scroll-target="#x-ray-fluorescence-xrf-elemental-analysis">3.1 X-ray fluorescence (XRF) elemental analysis</a></li>
  <li><a href="#fourier-transform-infrared-spectroscopy-ftir" id="toc-fourier-transform-infrared-spectroscopy-ftir" class="nav-link" data-scroll-target="#fourier-transform-infrared-spectroscopy-ftir">3.2 Fourier transform infrared spectroscopy (FTIR)</a></li>
  </ul></li>
  <li><a href="#wet-chemistry" id="toc-wet-chemistry" class="nav-link" data-scroll-target="#wet-chemistry">4. Wet chemistry</a></li>
  <li><a href="#join-and-clean-datasets" id="toc-join-and-clean-datasets" class="nav-link" data-scroll-target="#join-and-clean-datasets">5. Join and clean datasets</a>
  <ul class="collapse">
  <li><a href="#i-select-only-the-sample-that-are-in-the-compositional-dataframe-geoelements" id="toc-i-select-only-the-sample-that-are-in-the-compositional-dataframe-geoelements" class="nav-link" data-scroll-target="#i-select-only-the-sample-that-are-in-the-compositional-dataframe-geoelements">I select only the sample that are in the compositional dataframe “geoelements”</a></li>
  <li><a href="#the-composition-and-ftir-dataframes-have-same-sample-numbers-ssn-column" id="toc-the-composition-and-ftir-dataframes-have-same-sample-numbers-ssn-column" class="nav-link" data-scroll-target="#the-composition-and-ftir-dataframes-have-same-sample-numbers-ssn-column">The composition and FTIR dataframes have same sample numbers (SSN) column</a></li>
  <li><a href="#each-infrared-spectrum-corresponds-to-an-elemental-analysis" id="toc-each-infrared-spectrum-corresponds-to-an-elemental-analysis" class="nav-link" data-scroll-target="#each-infrared-spectrum-corresponds-to-an-elemental-analysis">Each infrared spectrum corresponds to an elemental analysis</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="prerequisities-and-import-libraries" class="level3">
<h3 class="anchored" data-anchor-id="prerequisities-and-import-libraries">1.1 Prerequisities and import libraries</h3>
<ul>
<li>To download data:
<ul>
<li>aws-cli</li>
</ul></li>
<li>To parse and manage datasets:
<ul>
<li>brukeropusreader</li>
<li>pandas</li>
<li>tqdm</li>
</ul></li>
</ul>
<p>Installation below:</p>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! pip install awscli brukeropusreader tqdm pandas matplotlib folium seaborn pathlib </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#commented out after the installation is completed in case you run again the notebook         </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#import pyspark</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> brukeropusreader <span class="im">import</span> read_file</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm_notebook <span class="im">as</span> tqdm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="downloading-the-soil-chemistry-dataset-from-aws" class="level3">
<h3 class="anchored" data-anchor-id="downloading-the-soil-chemistry-dataset-from-aws">1.2 Downloading the Soil Chemistry Dataset from AWS</h3>
<p>Download s3 bucket content with the <code>aws-cli</code> command line tool. Run <code>aws configure</code> beforehand to set your credentials.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! aws s3 sync s3://afsis afsis --no-sign-request </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># commented out after the download is completed in case you run again the notebook</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-opus-spectra" class="level3">
<h3 class="anchored" data-anchor-id="loading-opus-spectra">1.3 Loading OPUS spectra</h3>
<p>OPUS spectra are created using Bruker instruments Infrared spectrometers To be opened <a href="https://github.com/qedsoftware/brukeropusreader">brukeropusreader</a> package is needed.</p>
<p>The function <code>brukeropusreader.read_file</code> parses the binaries and returns a data structure containing information about the wave numbers, absorbance spectra, and file metadata.</p>
<p>Here we plot a few of the spectra.</p>
</section>
<section id="geographical-references" class="level2">
<h2 class="anchored" data-anchor-id="geographical-references">2. Geographical references</h2>
<p>The AfSIS Soil Chemistry Dataset contains georeferences for each spectra. It is worth noting that it consists of two datasets, one for the subsaharian Africa and one with additional data recorded only in Tanzania.</p>
<section id="dataframes-exploration" class="level3">
<h3 class="anchored" data-anchor-id="dataframes-exploration">2.1 Dataframes exploration</h3>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>GEOREFS_FILE1 <span class="op">=</span> <span class="st">'afsis/2009-2013/Georeferences/georeferences.csv'</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df_geo1 <span class="op">=</span> pd.read_csv(GEOREFS_FILE1)<span class="co"># dataframe for several african countries</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df_geo1 <span class="op">=</span> df_geo1.sort_values(by<span class="op">=</span>[<span class="st">'Site'</span>, <span class="st">'Cultivated'</span>])</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_geo1.shape)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_geo1.isna().<span class="bu">sum</span>())</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>df_geo1.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1843, 14)
SSN                0
Public             0
Latitude           0
Longitude          0
Cluster            0
Plot               0
Depth              0
Soil material     94
Scientist          0
Site               0
Country            0
Region           232
Cultivated       798
Gid                0
dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SSN</th>
<th data-quarto-table-cell-role="th">Public</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Cluster</th>
<th data-quarto-table-cell-role="th">Plot</th>
<th data-quarto-table-cell-role="th">Depth</th>
<th data-quarto-table-cell-role="th">Soil material</th>
<th data-quarto-table-cell-role="th">Scientist</th>
<th data-quarto-table-cell-role="th">Site</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Cultivated</th>
<th data-quarto-table-cell-role="th">Gid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">460</td>
<td>icr016032</td>
<td>True</td>
<td>5.423182</td>
<td>-0.709083</td>
<td>15</td>
<td>1</td>
<td>top</td>
<td>Aju.15.1.Topsoil.Std fine soil</td>
<td>Jerome Tondoh</td>
<td>Ajumako</td>
<td>Ghana</td>
<td>West Africa</td>
<td>False</td>
<td>345</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">500</td>
<td>icr016033</td>
<td>True</td>
<td>5.423182</td>
<td>-0.709083</td>
<td>15</td>
<td>1</td>
<td>sub</td>
<td>Aju.15.1.Subsoil.Std fine soil</td>
<td>Jerome Tondoh</td>
<td>Ajumako</td>
<td>Ghana</td>
<td>West Africa</td>
<td>False</td>
<td>346</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">666</td>
<td>icr015913</td>
<td>True</td>
<td>5.377035</td>
<td>-0.726425</td>
<td>9</td>
<td>1</td>
<td>sub</td>
<td>Aju.9.1.Subsoil.Std fine soil</td>
<td>Jerome Tondoh</td>
<td>Ajumako</td>
<td>Ghana</td>
<td>West Africa</td>
<td>False</td>
<td>334</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">732</td>
<td>icr016053</td>
<td>True</td>
<td>5.447667</td>
<td>-0.717422</td>
<td>16</td>
<td>1</td>
<td>sub</td>
<td>Aju.16.1.Subsoil.Std fine soil</td>
<td>Jerome Tondoh</td>
<td>Ajumako</td>
<td>Ghana</td>
<td>West Africa</td>
<td>False</td>
<td>348</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">957</td>
<td>icr015973</td>
<td>True</td>
<td>5.434675</td>
<td>-0.728883</td>
<td>12</td>
<td>1</td>
<td>sub</td>
<td>Aju.12.1.Subsoil.Std fine soil</td>
<td>Jerome Tondoh</td>
<td>Ajumako</td>
<td>Ghana</td>
<td>West Africa</td>
<td>False</td>
<td>340</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>GEOREFS_FILE2 <span class="op">=</span> <span class="st">'afsis/tansis/Georeferences/georeferences.csv'</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>df_geo2 <span class="op">=</span> pd.read_csv(GEOREFS_FILE2)<span class="co"># dataframe with additional data for Tanzania</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df_geo2 <span class="op">=</span> df_geo2.sort_values(by<span class="op">=</span>[<span class="st">'Site'</span>, <span class="st">'Cultivated'</span>])</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_geo2.shape)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>df_geo2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(18819, 14)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="86">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cluster</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Cultivated</th>
<th data-quarto-table-cell-role="th">Depth</th>
<th data-quarto-table-cell-role="th">Gid</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Plot</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">SSN</th>
<th data-quarto-table-cell-role="th">Sampling date</th>
<th data-quarto-table-cell-role="th">Scientist</th>
<th data-quarto-table-cell-role="th">Site</th>
<th data-quarto-table-cell-role="th">Soil material</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">29</td>
<td>2.0</td>
<td>Tanzania</td>
<td>False</td>
<td>top</td>
<td>46.0</td>
<td>-3.029698</td>
<td>33.015202</td>
<td>2.0</td>
<td>East Africa</td>
<td>icr011843</td>
<td>NaN</td>
<td>Leigh Winoweicki</td>
<td>Bukwaya</td>
<td>Buk.2.2.Topsoil.Std fine soil</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>4.0</td>
<td>Tanzania</td>
<td>False</td>
<td>top</td>
<td>48.0</td>
<td>-2.992815</td>
<td>33.016113</td>
<td>1.0</td>
<td>East Africa</td>
<td>icr011881</td>
<td>NaN</td>
<td>Leigh Winoweicki</td>
<td>Bukwaya</td>
<td>Buk.4.1.Topsoil.Std fine soil</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>5.0</td>
<td>Tanzania</td>
<td>False</td>
<td>top</td>
<td>49.0</td>
<td>-3.060982</td>
<td>33.030663</td>
<td>1.0</td>
<td>East Africa</td>
<td>icr011901</td>
<td>NaN</td>
<td>Leigh Winoweicki</td>
<td>Bukwaya</td>
<td>Buk.5.1.Topsoil.Std fine soil</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>8.0</td>
<td>Tanzania</td>
<td>False</td>
<td>top</td>
<td>52.0</td>
<td>-2.987467</td>
<td>33.033264</td>
<td>1.0</td>
<td>East Africa</td>
<td>icr011960</td>
<td>NaN</td>
<td>Leigh Winoweicki</td>
<td>Bukwaya</td>
<td>Buk.8.1.Topsoil.Std fine soil</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>9.0</td>
<td>Tanzania</td>
<td>False</td>
<td>top</td>
<td>53.0</td>
<td>-3.058480</td>
<td>33.065014</td>
<td>3.0</td>
<td>East Africa</td>
<td>icr011978</td>
<td>NaN</td>
<td>Leigh Winoweicki</td>
<td>Bukwaya</td>
<td>Buk.9.3.Topsoil.Std fine soil</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The tansis folder contains measurements for Tanzania only. FTIR spectra in this folder are not readable and make it unusable</p>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>todrop <span class="op">=</span> [<span class="st">'Soil material'</span>,<span class="st">'Scientist'</span>, <span class="st">'Site'</span>, <span class="st">'Region'</span>, <span class="st">'Gid'</span>,<span class="st">'Plot'</span>,<span class="st">'Public'</span>] <span class="co">#irrelevant</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df_geo <span class="op">=</span> df_geo1.drop(todrop, axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="dry-chemistry" class="level2">
<h2 class="anchored" data-anchor-id="dry-chemistry">3. Dry Chemistry</h2>
<p>The AfSIS Soil Chemistry dataset contains dry and wet chemistry data taken at each sampling location.</p>
<section id="x-ray-fluorescence-xrf-elemental-analysis" class="level3">
<h3 class="anchored" data-anchor-id="x-ray-fluorescence-xrf-elemental-analysis">3.1 X-ray fluorescence (XRF) elemental analysis</h3>
<p>with XRF we get the concentration of various chemical elements in the sample</p>
<p>Units are parts per million (ppm)</p>
<p>https://www.elementalanalysis.com/xrf.html</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>file1path <span class="op">=</span> <span class="st">"afsis/2009-2013/Dry_Chemistry/ICRAF/Bruker_TXRF/TXRF.csv"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>file2path <span class="op">=</span> <span class="st">"afsis/tansis/Dry_Chemistry/ICRAF/Bruker_TXRF/TXRF.csv"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>xrf_africa <span class="op">=</span> pd.read_csv(file1path)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>xrf_tanzania <span class="op">=</span> pd.read_csv(file2path)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'measurements 2009-13'</span>,xrf_africa.shape,<span class="st">'measurements  2014'</span>, xrf_tanzania.shape)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"the table below shows the concentration in ppm for each element detected"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>xrf_africa.head() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>measurements 2009-13 (1904, 42) measurements  2014 (224, 42)
the table below shows the concentration in ppm for each element detected</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SSN</th>
<th data-quarto-table-cell-role="th">Public</th>
<th data-quarto-table-cell-role="th">Na</th>
<th data-quarto-table-cell-role="th">Mg</th>
<th data-quarto-table-cell-role="th">Al</th>
<th data-quarto-table-cell-role="th">P</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">Cl</th>
<th data-quarto-table-cell-role="th">K</th>
<th data-quarto-table-cell-role="th">Ca</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Pr</th>
<th data-quarto-table-cell-role="th">Nd</th>
<th data-quarto-table-cell-role="th">Sm</th>
<th data-quarto-table-cell-role="th">Hf</th>
<th data-quarto-table-cell-role="th">Ta</th>
<th data-quarto-table-cell-role="th">W</th>
<th data-quarto-table-cell-role="th">Hg</th>
<th data-quarto-table-cell-role="th">Pb</th>
<th data-quarto-table-cell-role="th">Bi</th>
<th data-quarto-table-cell-role="th">Th</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>icr005965</td>
<td>True</td>
<td>16023.3</td>
<td>4433.5</td>
<td>37618.6</td>
<td>84.4</td>
<td>45.7</td>
<td>268.1</td>
<td>12412.2</td>
<td>30705.6</td>
<td>...</td>
<td>0.9</td>
<td>14.7</td>
<td>14.0</td>
<td>0.9</td>
<td>2.5</td>
<td>0.2</td>
<td>4.9</td>
<td>3.9</td>
<td>0.1</td>
<td>13.4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>icr005966</td>
<td>True</td>
<td>20524.6</td>
<td>5832.2</td>
<td>40248.2</td>
<td>72.1</td>
<td>45.7</td>
<td>229.6</td>
<td>12892.2</td>
<td>23234.5</td>
<td>...</td>
<td>1.1</td>
<td>15.8</td>
<td>18.2</td>
<td>0.5</td>
<td>3.2</td>
<td>0.2</td>
<td>4.2</td>
<td>3.3</td>
<td>0.1</td>
<td>19.9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>icr005985</td>
<td>True</td>
<td>19350.4</td>
<td>5085.8</td>
<td>36766.3</td>
<td>50.6</td>
<td>45.7</td>
<td>157.3</td>
<td>16839.7</td>
<td>16746.2</td>
<td>...</td>
<td>1.2</td>
<td>19.2</td>
<td>14.1</td>
<td>0.8</td>
<td>2.0</td>
<td>1.2</td>
<td>2.6</td>
<td>12.0</td>
<td>0.1</td>
<td>17.9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>icr005986</td>
<td>True</td>
<td>17410.2</td>
<td>5271.2</td>
<td>37912.2</td>
<td>50.6</td>
<td>45.7</td>
<td>285.2</td>
<td>16818.0</td>
<td>31939.6</td>
<td>...</td>
<td>1.1</td>
<td>16.7</td>
<td>12.6</td>
<td>0.3</td>
<td>1.2</td>
<td>0.5</td>
<td>6.3</td>
<td>10.2</td>
<td>0.1</td>
<td>16.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>icr005998</td>
<td>True</td>
<td>19092.5</td>
<td>9169.8</td>
<td>37359.8</td>
<td>50.6</td>
<td>45.7</td>
<td>251.4</td>
<td>17577.9</td>
<td>25298.2</td>
<td>...</td>
<td>1.1</td>
<td>16.7</td>
<td>17.2</td>
<td>0.5</td>
<td>3.2</td>
<td>0.4</td>
<td>4.2</td>
<td>5.6</td>
<td>0.1</td>
<td>18.4</td>
</tr>
</tbody>
</table>

<p>5 rows × 42 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mask_diff_xrf <span class="op">=</span> xrf_africa[xrf_africa[<span class="st">'SSN'</span>].isin(diff_list )]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df_xrf <span class="op">=</span> pd.concat([xrf_tanzania, mask_diff_xrf]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_xrf.shape, <span class="bu">len</span>(df_xrf.SSN.unique()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1838, 42) 1838</code></pre>
</div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'important elements for agriculture'</span>) </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.qld.gov.au/environment/land/management/soil/soil-properties/fertility</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>important_elements <span class="op">=</span> [<span class="st">'P'</span>,<span class="st">'K'</span>, <span class="st">'S'</span>,<span class="st">'Ca'</span>,<span class="st">'Mg'</span>,<span class="st">'Cu'</span>,<span class="st">'Cl'</span>,<span class="st">'Zn'</span>,<span class="st">'Fe'</span>, <span class="st">'Mn'</span>,<span class="st">'Mo'</span> ]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>df_xrf_reduced <span class="op">=</span> df_xrf[important_elements]<span class="co">#/10000# express in %</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>df_xrf_reduced[<span class="st">'SSN'</span>] <span class="op">=</span> df_xrf[<span class="st">'SSN'</span>]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>df_xrf_reduced.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>important elements for agriculture</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_xrf_reduced['SSN'] = df_xrf['SSN']</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="83">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">P</th>
<th data-quarto-table-cell-role="th">K</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">Ca</th>
<th data-quarto-table-cell-role="th">Mg</th>
<th data-quarto-table-cell-role="th">Cu</th>
<th data-quarto-table-cell-role="th">Cl</th>
<th data-quarto-table-cell-role="th">Zn</th>
<th data-quarto-table-cell-role="th">Fe</th>
<th data-quarto-table-cell-role="th">Mn</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">SSN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>84.4</td>
<td>12412.2</td>
<td>45.7</td>
<td>30705.6</td>
<td>4433.5</td>
<td>10.1</td>
<td>268.1</td>
<td>25.3</td>
<td>22263.2</td>
<td>356.1</td>
<td>184.5</td>
<td>icr005965</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>72.1</td>
<td>12892.2</td>
<td>45.7</td>
<td>23234.5</td>
<td>5832.2</td>
<td>11.8</td>
<td>229.6</td>
<td>29.4</td>
<td>26269.6</td>
<td>379.7</td>
<td>184.5</td>
<td>icr005966</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>50.6</td>
<td>16839.7</td>
<td>45.7</td>
<td>16746.2</td>
<td>5085.8</td>
<td>22.1</td>
<td>157.3</td>
<td>32.4</td>
<td>22790.2</td>
<td>323.4</td>
<td>184.5</td>
<td>icr005985</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>50.6</td>
<td>16818.0</td>
<td>45.7</td>
<td>31939.6</td>
<td>5271.2</td>
<td>24.9</td>
<td>285.2</td>
<td>34.4</td>
<td>22939.1</td>
<td>332.5</td>
<td>184.5</td>
<td>icr005986</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>50.6</td>
<td>17577.9</td>
<td>45.7</td>
<td>25298.2</td>
<td>9169.8</td>
<td>13.1</td>
<td>251.4</td>
<td>35.4</td>
<td>24985.2</td>
<td>408.3</td>
<td>184.5</td>
<td>icr005998</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how disperse are the XRF data?</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_xrf_reduced.shape)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df_xrf_reduced.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1838, 12)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">P</th>
<th data-quarto-table-cell-role="th">K</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">Ca</th>
<th data-quarto-table-cell-role="th">Mg</th>
<th data-quarto-table-cell-role="th">Cu</th>
<th data-quarto-table-cell-role="th">Cl</th>
<th data-quarto-table-cell-role="th">Zn</th>
<th data-quarto-table-cell-role="th">Fe</th>
<th data-quarto-table-cell-role="th">Mn</th>
<th data-quarto-table-cell-role="th">Mo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1838.000000</td>
<td>1838.000000</td>
<td>1838.000000</td>
<td>1838.000000</td>
<td>1838.000000</td>
<td>1838.000000</td>
<td>1838.000000</td>
<td>1838.000000</td>
<td>1838.000000</td>
<td>1838.000000</td>
<td>1838.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.011513</td>
<td>1.126107</td>
<td>0.007641</td>
<td>0.758606</td>
<td>0.730171</td>
<td>0.001519</td>
<td>0.026368</td>
<td>0.002566</td>
<td>2.633472</td>
<td>0.040358</td>
<td>0.019379</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.046650</td>
<td>1.268460</td>
<td>0.040276</td>
<td>2.284191</td>
<td>0.733123</td>
<td>0.001496</td>
<td>0.222005</td>
<td>0.002984</td>
<td>2.673819</td>
<td>0.052072</td>
<td>0.012800</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.002950</td>
<td>0.009040</td>
<td>0.003320</td>
<td>0.004400</td>
<td>0.402890</td>
<td>0.000050</td>
<td>0.000600</td>
<td>0.000090</td>
<td>0.007430</td>
<td>0.000540</td>
<td>0.017950</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.005060</td>
<td>0.240008</td>
<td>0.004570</td>
<td>0.046742</td>
<td>0.557500</td>
<td>0.000450</td>
<td>0.005687</td>
<td>0.000780</td>
<td>0.779240</td>
<td>0.010405</td>
<td>0.018450</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.005060</td>
<td>0.696950</td>
<td>0.004570</td>
<td>0.141455</td>
<td>0.557500</td>
<td>0.001125</td>
<td>0.010050</td>
<td>0.001890</td>
<td>1.947845</td>
<td>0.022950</td>
<td>0.018450</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>0.005060</td>
<td>1.624108</td>
<td>0.004570</td>
<td>0.518190</td>
<td>0.557500</td>
<td>0.002050</td>
<td>0.016350</td>
<td>0.003437</td>
<td>3.452745</td>
<td>0.052255</td>
<td>0.018450</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.246380</td>
<td>10.627340</td>
<td>0.970400</td>
<td>42.643090</td>
<td>13.689340</td>
<td>0.012840</td>
<td>7.438340</td>
<td>0.073000</td>
<td>22.908970</td>
<td>0.660790</td>
<td>0.444250</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="fourier-transform-infrared-spectroscopy-ftir" class="level3">
<h3 class="anchored" data-anchor-id="fourier-transform-infrared-spectroscopy-ftir">3.2 Fourier transform infrared spectroscopy (FTIR)</h3>
<p>A word about units. Most spectra using electromagnetic radiation are presented with wavelength as the X-axis in nm or μm. Originally, IR spectra were presented in units of micrometers. Later (1953) a different measure, the wavenumber given the unit cm-1, was adopted.</p>
<p>ν (cm-1)= 10,000/λ (μm)</p>
<p>The spectra may appear to be “backward” (large wavenumber values on the left, running to low values on the right); this is a consequence of the μm to cm-1 conversion</p>
<section id="nir-near-infrared-range-ftir" class="level4">
<h4 class="anchored" data-anchor-id="nir-near-infrared-range-ftir">3.2.1 NIR (near infrared range) FTIR</h4>
<p>spectral range: 12500 - 4000 cm-1 or 700 - 2500 nm for near infrared (NIR)</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>Image(filename<span class="op">=</span><span class="st">'img/NIR.jpeg'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<p><img src="afsis-soil-chem-EDA_files/figure-html/cell-13-output-1.jpeg" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>NIR_SPECTRA_DIR <span class="op">=</span> <span class="st">'Bruker_MPA/*'</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>AFSIS_PATH <span class="op">=</span> Path(<span class="st">'afsis/2009-2013/Dry_Chemistry/ICRAF'</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> []</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>spectra <span class="op">=</span> []</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> tqdm(AFSIS_PATH.glob(NIR_SPECTRA_DIR )):</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> path.is_file():</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        spect_data <span class="op">=</span> read_file(path)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        spectra.append(spect_data[<span class="st">"AB"</span>])</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        names.append(path.stem)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>wave_nums <span class="op">=</span> spect_data.get_range()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>column_names <span class="op">=</span> [<span class="st">'</span><span class="sc">{:.0f}</span><span class="st">'</span>.<span class="bu">format</span>(x) <span class="cf">for</span> x <span class="kw">in</span> wave_nums]</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>near_infrared_df <span class="op">=</span> pd.DataFrame(spectra, index<span class="op">=</span>names, columns<span class="op">=</span>column_names)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>near_infrared_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0
Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`
  for path in tqdm(AFSIS_PATH.glob(NIR_SPECTRA_DIR )):</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"14e4f94560284205a641cce2b4097a95","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">12493</th>
<th data-quarto-table-cell-role="th">12489</th>
<th data-quarto-table-cell-role="th">12485</th>
<th data-quarto-table-cell-role="th">12482</th>
<th data-quarto-table-cell-role="th">12478</th>
<th data-quarto-table-cell-role="th">12474</th>
<th data-quarto-table-cell-role="th">12470</th>
<th data-quarto-table-cell-role="th">12466</th>
<th data-quarto-table-cell-role="th">12462</th>
<th data-quarto-table-cell-role="th">12458</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">3633</th>
<th data-quarto-table-cell-role="th">3630</th>
<th data-quarto-table-cell-role="th">3626</th>
<th data-quarto-table-cell-role="th">3622</th>
<th data-quarto-table-cell-role="th">3618</th>
<th data-quarto-table-cell-role="th">3614</th>
<th data-quarto-table-cell-role="th">3610</th>
<th data-quarto-table-cell-role="th">3606</th>
<th data-quarto-table-cell-role="th">3603</th>
<th data-quarto-table-cell-role="th">3599</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr033603</td>
<td>0.744053</td>
<td>0.744943</td>
<td>0.737978</td>
<td>0.734149</td>
<td>0.738894</td>
<td>0.741579</td>
<td>0.738796</td>
<td>0.740573</td>
<td>0.745435</td>
<td>0.745959</td>
<td>...</td>
<td>2.679350</td>
<td>2.639192</td>
<td>2.631729</td>
<td>2.611440</td>
<td>2.646616</td>
<td>2.508814</td>
<td>2.414326</td>
<td>2.423105</td>
<td>2.533958</td>
<td>2.656340</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">icr042897</td>
<td>0.553651</td>
<td>0.549628</td>
<td>0.549979</td>
<td>0.555073</td>
<td>0.561452</td>
<td>0.566700</td>
<td>0.571925</td>
<td>0.578335</td>
<td>0.582339</td>
<td>0.579222</td>
<td>...</td>
<td>2.455164</td>
<td>2.484992</td>
<td>2.565423</td>
<td>2.588626</td>
<td>2.550071</td>
<td>2.503246</td>
<td>2.361378</td>
<td>2.318084</td>
<td>2.421962</td>
<td>2.429910</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr049675</td>
<td>0.533260</td>
<td>0.531480</td>
<td>0.535772</td>
<td>0.545087</td>
<td>0.551631</td>
<td>0.550375</td>
<td>0.546267</td>
<td>0.545179</td>
<td>0.545328</td>
<td>0.542055</td>
<td>...</td>
<td>2.641663</td>
<td>2.420862</td>
<td>2.309041</td>
<td>2.268263</td>
<td>2.305246</td>
<td>2.589037</td>
<td>2.847070</td>
<td>2.433076</td>
<td>2.500584</td>
<td>2.292974</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">icr034693</td>
<td>0.568058</td>
<td>0.566100</td>
<td>0.563312</td>
<td>0.560136</td>
<td>0.556757</td>
<td>0.558751</td>
<td>0.566576</td>
<td>0.575022</td>
<td>0.580073</td>
<td>0.579828</td>
<td>...</td>
<td>2.410610</td>
<td>2.373128</td>
<td>2.324080</td>
<td>2.145765</td>
<td>2.025990</td>
<td>2.089124</td>
<td>2.294537</td>
<td>2.543749</td>
<td>2.517684</td>
<td>2.474452</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr033950</td>
<td>0.555743</td>
<td>0.550596</td>
<td>0.548068</td>
<td>0.554348</td>
<td>0.559019</td>
<td>0.554218</td>
<td>0.551323</td>
<td>0.556638</td>
<td>0.561071</td>
<td>0.562413</td>
<td>...</td>
<td>2.714783</td>
<td>2.360171</td>
<td>2.265779</td>
<td>2.247130</td>
<td>2.206304</td>
<td>2.150379</td>
<td>2.145735</td>
<td>2.169409</td>
<td>2.158581</td>
<td>2.150478</td>
</tr>
</tbody>
</table>

<p>5 rows × 2307 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table with FTIR spectra for each sample</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df_NIR_FTIRspectra <span class="op">=</span> near_infrared_df.T.reset_index()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>df_NIR_FTIRspectra <span class="op">=</span> df_NIR_FTIRspectra.rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'labda'</span>})</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>df_NIR_FTIRspectra.labda <span class="op">=</span> pd.to_numeric(df_NIR_FTIRspectra.labda)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>df_NIR_FTIRspectra.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">labda</th>
<th data-quarto-table-cell-role="th">icr033603</th>
<th data-quarto-table-cell-role="th">icr042897</th>
<th data-quarto-table-cell-role="th">icr049675</th>
<th data-quarto-table-cell-role="th">icr034693</th>
<th data-quarto-table-cell-role="th">icr033950</th>
<th data-quarto-table-cell-role="th">icr034794</th>
<th data-quarto-table-cell-role="th">icr015953</th>
<th data-quarto-table-cell-role="th">icr050394</th>
<th data-quarto-table-cell-role="th">icr048771</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">icr073540</th>
<th data-quarto-table-cell-role="th">icr049437</th>
<th data-quarto-table-cell-role="th">icr037699</th>
<th data-quarto-table-cell-role="th">icr075004</th>
<th data-quarto-table-cell-role="th">icr056181</th>
<th data-quarto-table-cell-role="th">icr055563</th>
<th data-quarto-table-cell-role="th">icr010159</th>
<th data-quarto-table-cell-role="th">icr074792</th>
<th data-quarto-table-cell-role="th">icr011321</th>
<th data-quarto-table-cell-role="th">icr062275</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>12493</td>
<td>0.744053</td>
<td>0.553651</td>
<td>0.533260</td>
<td>0.568058</td>
<td>0.555743</td>
<td>0.643860</td>
<td>0.431300</td>
<td>0.684270</td>
<td>0.569734</td>
<td>...</td>
<td>0.268871</td>
<td>0.623325</td>
<td>0.427489</td>
<td>0.664087</td>
<td>0.612543</td>
<td>0.400455</td>
<td>0.604818</td>
<td>0.511006</td>
<td>0.633803</td>
<td>0.539674</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>12489</td>
<td>0.744943</td>
<td>0.549628</td>
<td>0.531480</td>
<td>0.566100</td>
<td>0.550596</td>
<td>0.648193</td>
<td>0.434562</td>
<td>0.684778</td>
<td>0.567334</td>
<td>...</td>
<td>0.266468</td>
<td>0.631448</td>
<td>0.425584</td>
<td>0.665025</td>
<td>0.612217</td>
<td>0.398957</td>
<td>0.605491</td>
<td>0.507771</td>
<td>0.635440</td>
<td>0.541978</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>12485</td>
<td>0.737978</td>
<td>0.549979</td>
<td>0.535772</td>
<td>0.563312</td>
<td>0.548068</td>
<td>0.648293</td>
<td>0.435362</td>
<td>0.677241</td>
<td>0.563958</td>
<td>...</td>
<td>0.265169</td>
<td>0.638345</td>
<td>0.430387</td>
<td>0.654435</td>
<td>0.615592</td>
<td>0.396526</td>
<td>0.604928</td>
<td>0.507411</td>
<td>0.637939</td>
<td>0.545053</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>12482</td>
<td>0.734149</td>
<td>0.555073</td>
<td>0.545087</td>
<td>0.560136</td>
<td>0.554348</td>
<td>0.642154</td>
<td>0.436202</td>
<td>0.676640</td>
<td>0.561916</td>
<td>...</td>
<td>0.265009</td>
<td>0.636849</td>
<td>0.433966</td>
<td>0.644498</td>
<td>0.619221</td>
<td>0.399731</td>
<td>0.601859</td>
<td>0.511584</td>
<td>0.640378</td>
<td>0.543280</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>12478</td>
<td>0.738894</td>
<td>0.561452</td>
<td>0.551631</td>
<td>0.556757</td>
<td>0.559019</td>
<td>0.641057</td>
<td>0.436053</td>
<td>0.683005</td>
<td>0.566201</td>
<td>...</td>
<td>0.265186</td>
<td>0.632287</td>
<td>0.433450</td>
<td>0.646780</td>
<td>0.623118</td>
<td>0.405075</td>
<td>0.597800</td>
<td>0.517670</td>
<td>0.642512</td>
<td>0.540592</td>
</tr>
</tbody>
</table>

<p>5 rows × 1908 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span> (<span class="dv">6</span>,<span class="dv">6</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>plt.plot(df_NIR_FTIRspectra[<span class="st">'labda'</span>],df_NIR_FTIRspectra.iloc[:, [<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">18</span>]]) </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Example spectra'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">12000</span>,<span class="dv">3500</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Absorbance (A.U.)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Wavelengths (cm-1)'</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="dv">7500</span> , ymin<span class="op">=</span><span class="dv">0</span>, ymax<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'r'</span>, linewidth <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="dv">4000</span>, ymin<span class="op">=</span><span class="dv">0</span>, ymax<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'r'</span>, linewidth <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>plt.text(<span class="dv">7400</span>, <span class="fl">2.5</span>, <span class="st">'useful range between </span><span class="ch">\n</span><span class="st"> red lines'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>Text(7400, 2.5, 'useful range between \n red lines')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="afsis-soil-chem-EDA_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>In the region 12000 - 7500 cm-1 there are no peaks, this part of the spectrum can be ignored below 4000 cm-1 the signal is unrealistic. It is an experimental artifact and this part of the spectrum should be cut off.</p>
<p>Absorbance in this range is analized with mid-range FTIR spectrometers (see section 3.2.2 below)</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_NIR_FTIRspectra <span class="op">=</span>  df_NIR_FTIRspectra[df_NIR_FTIRspectra[<span class="st">'labda'</span>] <span class="op">&lt;</span> <span class="dv">7500</span>]  </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_NIR_FTIRspectra <span class="op">=</span> df_NIR_FTIRspectra[df_NIR_FTIRspectra[<span class="st">'labda'</span>] <span class="op">&gt;</span> <span class="dv">4000</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span> (<span class="dv">6</span>,<span class="dv">6</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>plt.plot(df_NIR_FTIRspectra[<span class="st">'labda'</span>],df_NIR_FTIRspectra.iloc[:, [<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">12</span>,<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">48</span>]]) </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Example reduced spectra'</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">7500</span>,<span class="dv">4000</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Absorbance (A.U.)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Wavelengths (cm-1)'</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>Text(0.5, 0, 'Wavelengths (cm-1)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="afsis-soil-chem-EDA_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change original dataset accordingly</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>df_NIR_reindexed <span class="op">=</span> df_NIR_FTIRspectra.set_index(<span class="st">'labda'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>near_infrared_df <span class="op">=</span> df_NIR_reindexed.T</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>near_infrared_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">labda</th>
<th data-quarto-table-cell-role="th">7498</th>
<th data-quarto-table-cell-role="th">7494</th>
<th data-quarto-table-cell-role="th">7491</th>
<th data-quarto-table-cell-role="th">7487</th>
<th data-quarto-table-cell-role="th">7483</th>
<th data-quarto-table-cell-role="th">7479</th>
<th data-quarto-table-cell-role="th">7475</th>
<th data-quarto-table-cell-role="th">7471</th>
<th data-quarto-table-cell-role="th">7467</th>
<th data-quarto-table-cell-role="th">7464</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">4038</th>
<th data-quarto-table-cell-role="th">4035</th>
<th data-quarto-table-cell-role="th">4031</th>
<th data-quarto-table-cell-role="th">4027</th>
<th data-quarto-table-cell-role="th">4023</th>
<th data-quarto-table-cell-role="th">4019</th>
<th data-quarto-table-cell-role="th">4015</th>
<th data-quarto-table-cell-role="th">4011</th>
<th data-quarto-table-cell-role="th">4008</th>
<th data-quarto-table-cell-role="th">4004</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr033603</td>
<td>0.469107</td>
<td>0.469056</td>
<td>0.469180</td>
<td>0.469344</td>
<td>0.469312</td>
<td>0.469145</td>
<td>0.469012</td>
<td>0.469019</td>
<td>0.469138</td>
<td>0.469201</td>
<td>...</td>
<td>0.693520</td>
<td>0.696103</td>
<td>0.698850</td>
<td>0.701674</td>
<td>0.704414</td>
<td>0.707121</td>
<td>0.709787</td>
<td>0.712360</td>
<td>0.714864</td>
<td>0.717183</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">icr042897</td>
<td>0.453903</td>
<td>0.453874</td>
<td>0.453821</td>
<td>0.453781</td>
<td>0.453818</td>
<td>0.453874</td>
<td>0.453957</td>
<td>0.454082</td>
<td>0.454211</td>
<td>0.454340</td>
<td>...</td>
<td>0.679447</td>
<td>0.681886</td>
<td>0.684869</td>
<td>0.687917</td>
<td>0.690609</td>
<td>0.692926</td>
<td>0.694870</td>
<td>0.696561</td>
<td>0.698304</td>
<td>0.700157</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr049675</td>
<td>0.311495</td>
<td>0.311474</td>
<td>0.311484</td>
<td>0.311448</td>
<td>0.311298</td>
<td>0.311103</td>
<td>0.310900</td>
<td>0.310745</td>
<td>0.310745</td>
<td>0.310800</td>
<td>...</td>
<td>0.471828</td>
<td>0.473717</td>
<td>0.475707</td>
<td>0.477803</td>
<td>0.479886</td>
<td>0.481793</td>
<td>0.483479</td>
<td>0.485172</td>
<td>0.487041</td>
<td>0.488976</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">icr034693</td>
<td>0.420559</td>
<td>0.420480</td>
<td>0.420528</td>
<td>0.420549</td>
<td>0.420534</td>
<td>0.420425</td>
<td>0.420276</td>
<td>0.420284</td>
<td>0.420467</td>
<td>0.420655</td>
<td>...</td>
<td>0.695133</td>
<td>0.698124</td>
<td>0.701617</td>
<td>0.705556</td>
<td>0.709398</td>
<td>0.712633</td>
<td>0.715035</td>
<td>0.716666</td>
<td>0.718061</td>
<td>0.719766</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr033950</td>
<td>0.327227</td>
<td>0.327036</td>
<td>0.326880</td>
<td>0.326711</td>
<td>0.326502</td>
<td>0.326389</td>
<td>0.326441</td>
<td>0.326477</td>
<td>0.326314</td>
<td>0.325999</td>
<td>...</td>
<td>0.437366</td>
<td>0.439201</td>
<td>0.441031</td>
<td>0.442873</td>
<td>0.444723</td>
<td>0.446564</td>
<td>0.448291</td>
<td>0.449815</td>
<td>0.451223</td>
<td>0.452619</td>
</tr>
</tbody>
</table>

<p>5 rows × 907 columns</p>
</div>
</div>
</div>
</section>
<section id="mir-middle-infrared-range-ftir" class="level4">
<h4 class="anchored" data-anchor-id="mir-middle-infrared-range-ftir">3.2.2 MIR (middle infrared range) FTIR</h4>
<p>spectral range 400 - 4000 cm-1</p>
<p>data recorded with three spectrometers that differ for the method for collecting data.</p>
<ul>
<li>ALPHA Kbr spectrometer: transmission, using samples pressed into a Kbr pellet</li>
<li>ALPHA ZnSe spectrometer: reflection over a diamond window and ZnSe filter / beam splitter</li>
<li>Tensor27 Kbr spectrometer further reading about experimental details can be found at afsis/2009-2013/Dry_Chemistry/ICRAF/SOP/METH07V01 ALPHA.pdf</li>
</ul>
<p>and a general introduction can be found here: https://www.shimadzu.com/an/service-support/technical-support/analysis-basics/ftirtalk/talk8.html</p>
<ul>
<li>2014-2018 Most FTIR spectra could not be opened using the Bruker open files library, in this kernel only those obtained with the Tensor27 spectrometer are analyzed</li>
</ul>
<section id="alpha-spectrometer---kbr-window" class="level5">
<h5 class="anchored" data-anchor-id="alpha-spectrometer---kbr-window">- ALPHA spectrometer - KBr window</h5>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>KBR_SPECTRA_DIR <span class="op">=</span> <span class="st">'Bruker_Alpha_KBr/*'</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>AFSIS_PATH <span class="op">=</span> Path(<span class="st">'afsis/2009-2013/Dry_Chemistry/ICRAF'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>TANSIS_PATH <span class="op">=</span> Path(<span class="st">'afsis/tansis/Dry_Chemistry/ICRAF'</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> []</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>spectra <span class="op">=</span> []</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> tqdm(AFSIS_PATH.glob(KBR_SPECTRA_DIR )):</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> path.is_file():</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        spect_data <span class="op">=</span> read_file(path)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        spectra.append(spect_data[<span class="st">"AB"</span>])</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        names.append(path.stem)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>wave_nums <span class="op">=</span> spect_data.get_range()</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>column_names <span class="op">=</span> [<span class="st">'</span><span class="sc">{:.0f}</span><span class="st">'</span>.<span class="bu">format</span>(x) <span class="cf">for</span> x <span class="kw">in</span> wave_nums]</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>kbr_df <span class="op">=</span> pd.DataFrame(spectra, index<span class="op">=</span>names, columns<span class="op">=</span>column_names)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>kbr_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0
Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`
  for path in tqdm(AFSIS_PATH.glob(KBR_SPECTRA_DIR )):</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"3628a93653c645d6a3d45265d77c76a1","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">3998</th>
<th data-quarto-table-cell-role="th">3997</th>
<th data-quarto-table-cell-role="th">3996</th>
<th data-quarto-table-cell-role="th">3994</th>
<th data-quarto-table-cell-role="th">3993</th>
<th data-quarto-table-cell-role="th">3991</th>
<th data-quarto-table-cell-role="th">3990</th>
<th data-quarto-table-cell-role="th">3988</th>
<th data-quarto-table-cell-role="th">3987</th>
<th data-quarto-table-cell-role="th">3986</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">412</th>
<th data-quarto-table-cell-role="th">411</th>
<th data-quarto-table-cell-role="th">409</th>
<th data-quarto-table-cell-role="th">408</th>
<th data-quarto-table-cell-role="th">406</th>
<th data-quarto-table-cell-role="th">405</th>
<th data-quarto-table-cell-role="th">404</th>
<th data-quarto-table-cell-role="th">402</th>
<th data-quarto-table-cell-role="th">401</th>
<th data-quarto-table-cell-role="th">399</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr033603</td>
<td>0.908592</td>
<td>0.908981</td>
<td>0.909435</td>
<td>0.909956</td>
<td>0.910562</td>
<td>0.911266</td>
<td>0.912069</td>
<td>0.912953</td>
<td>0.913888</td>
<td>0.914843</td>
<td>...</td>
<td>1.849416</td>
<td>1.860089</td>
<td>1.872713</td>
<td>1.885405</td>
<td>1.896269</td>
<td>1.903926</td>
<td>1.908109</td>
<td>1.910104</td>
<td>1.912738</td>
<td>1.919517</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">icr042897</td>
<td>0.810133</td>
<td>0.809940</td>
<td>0.809745</td>
<td>0.809616</td>
<td>0.809566</td>
<td>0.809563</td>
<td>0.809558</td>
<td>0.809516</td>
<td>0.809437</td>
<td>0.809359</td>
<td>...</td>
<td>2.069042</td>
<td>2.098991</td>
<td>2.124525</td>
<td>2.143315</td>
<td>2.153621</td>
<td>2.154386</td>
<td>2.145273</td>
<td>2.126816</td>
<td>2.101002</td>
<td>2.071937</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr049675</td>
<td>0.711836</td>
<td>0.712355</td>
<td>0.713021</td>
<td>0.713747</td>
<td>0.714438</td>
<td>0.715037</td>
<td>0.715535</td>
<td>0.715951</td>
<td>0.716298</td>
<td>0.716546</td>
<td>...</td>
<td>2.042677</td>
<td>2.025819</td>
<td>2.009498</td>
<td>1.997672</td>
<td>1.991367</td>
<td>1.989609</td>
<td>1.990601</td>
<td>1.992822</td>
<td>1.995704</td>
<td>1.999495</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">icr034693</td>
<td>0.788686</td>
<td>0.789201</td>
<td>0.789494</td>
<td>0.789611</td>
<td>0.789634</td>
<td>0.789656</td>
<td>0.789744</td>
<td>0.789912</td>
<td>0.790109</td>
<td>0.790249</td>
<td>...</td>
<td>2.083768</td>
<td>2.084394</td>
<td>2.084220</td>
<td>2.081256</td>
<td>2.072820</td>
<td>2.055961</td>
<td>2.028284</td>
<td>1.989270</td>
<td>1.941584</td>
<td>1.891300</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr033950</td>
<td>0.752478</td>
<td>0.753251</td>
<td>0.753915</td>
<td>0.754423</td>
<td>0.754733</td>
<td>0.754816</td>
<td>0.754683</td>
<td>0.754402</td>
<td>0.754084</td>
<td>0.753866</td>
<td>...</td>
<td>1.925999</td>
<td>1.940593</td>
<td>1.958213</td>
<td>1.975761</td>
<td>1.988359</td>
<td>1.990657</td>
<td>1.979214</td>
<td>1.954502</td>
<td>1.920762</td>
<td>1.884145</td>
</tr>
</tbody>
</table>

<p>5 rows × 2542 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table with FTIR spectra for each sample</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df_KBR_FTIRspectra <span class="op">=</span> kbr_df.T.reset_index()</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>df_KBR_FTIRspectra <span class="op">=</span> df_KBR_FTIRspectra.rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'labda'</span>})</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>df_KBR_FTIRspectra.labda <span class="op">=</span> pd.to_numeric(df_KBR_FTIRspectra.labda)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>df_KBR_FTIRspectra.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">labda</th>
<th data-quarto-table-cell-role="th">icr033603</th>
<th data-quarto-table-cell-role="th">icr042897</th>
<th data-quarto-table-cell-role="th">icr049675</th>
<th data-quarto-table-cell-role="th">icr034693</th>
<th data-quarto-table-cell-role="th">icr033950</th>
<th data-quarto-table-cell-role="th">icr034794</th>
<th data-quarto-table-cell-role="th">icr015953</th>
<th data-quarto-table-cell-role="th">icr050394</th>
<th data-quarto-table-cell-role="th">icr048771</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">icr011182</th>
<th data-quarto-table-cell-role="th">icr073540</th>
<th data-quarto-table-cell-role="th">icr049437</th>
<th data-quarto-table-cell-role="th">icr037699</th>
<th data-quarto-table-cell-role="th">icr056181</th>
<th data-quarto-table-cell-role="th">icr055563</th>
<th data-quarto-table-cell-role="th">icr010159</th>
<th data-quarto-table-cell-role="th">icr074792</th>
<th data-quarto-table-cell-role="th">icr011321</th>
<th data-quarto-table-cell-role="th">icr062275</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3998</td>
<td>0.908592</td>
<td>0.810133</td>
<td>0.711836</td>
<td>0.788686</td>
<td>0.752478</td>
<td>0.799947</td>
<td>0.819920</td>
<td>0.701762</td>
<td>0.854325</td>
<td>...</td>
<td>0.741123</td>
<td>0.707601</td>
<td>0.735885</td>
<td>0.792272</td>
<td>0.784010</td>
<td>0.675416</td>
<td>0.859956</td>
<td>0.675066</td>
<td>0.807336</td>
<td>0.753118</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3997</td>
<td>0.908981</td>
<td>0.809940</td>
<td>0.712355</td>
<td>0.789201</td>
<td>0.753251</td>
<td>0.801083</td>
<td>0.819910</td>
<td>0.702142</td>
<td>0.854623</td>
<td>...</td>
<td>0.741535</td>
<td>0.707462</td>
<td>0.735881</td>
<td>0.793356</td>
<td>0.784840</td>
<td>0.675505</td>
<td>0.859586</td>
<td>0.675193</td>
<td>0.807802</td>
<td>0.753273</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3996</td>
<td>0.909435</td>
<td>0.809745</td>
<td>0.713021</td>
<td>0.789494</td>
<td>0.753915</td>
<td>0.802259</td>
<td>0.820077</td>
<td>0.702510</td>
<td>0.854676</td>
<td>...</td>
<td>0.741678</td>
<td>0.707289</td>
<td>0.735951</td>
<td>0.794496</td>
<td>0.785365</td>
<td>0.675546</td>
<td>0.859557</td>
<td>0.675159</td>
<td>0.808202</td>
<td>0.753584</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3994</td>
<td>0.909956</td>
<td>0.809616</td>
<td>0.713747</td>
<td>0.789611</td>
<td>0.754423</td>
<td>0.803318</td>
<td>0.820496</td>
<td>0.702824</td>
<td>0.854543</td>
<td>...</td>
<td>0.741524</td>
<td>0.707115</td>
<td>0.736090</td>
<td>0.795609</td>
<td>0.785554</td>
<td>0.675588</td>
<td>0.859890</td>
<td>0.674942</td>
<td>0.808552</td>
<td>0.754089</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3993</td>
<td>0.910562</td>
<td>0.809566</td>
<td>0.714438</td>
<td>0.789634</td>
<td>0.754733</td>
<td>0.804114</td>
<td>0.821235</td>
<td>0.703081</td>
<td>0.854348</td>
<td>...</td>
<td>0.741103</td>
<td>0.706966</td>
<td>0.736295</td>
<td>0.796670</td>
<td>0.785448</td>
<td>0.675682</td>
<td>0.860528</td>
<td>0.674554</td>
<td>0.808865</td>
<td>0.754796</td>
</tr>
</tbody>
</table>

<p>5 rows × 1889 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span> (<span class="dv">6</span>,<span class="dv">6</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>plt.plot(df_KBR_FTIRspectra[<span class="st">'labda'</span>],df_KBR_FTIRspectra.iloc[:, [<span class="dv">4</span>,<span class="dv">257</span>,<span class="dv">100</span>]]) </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Example spectra MIR-FTIR KBr window'</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">4000</span>,<span class="dv">400</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Absorbance (A.U.)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Wavelengths (cm-1)'</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>Text(0.5, 0, 'Wavelengths (cm-1)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="afsis-soil-chem-EDA_files/figure-html/cell-22-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="alpha-spectrometer---znse-window" class="level5">
<h5 class="anchored" data-anchor-id="alpha-spectrometer---znse-window">- Alpha spectrometer - ZnSe window</h5>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ZnSe_SPECTRA_DIR <span class="op">=</span> <span class="st">'Bruker_Alpha_ZnSe/*'</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>AFSIS_PATH <span class="op">=</span> Path(<span class="st">'afsis/2009-2013/Dry_Chemistry/ICRAF'</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> []</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>spectra <span class="op">=</span> []</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> tqdm(AFSIS_PATH.glob(ZnSe_SPECTRA_DIR )):</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> path.is_file():</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        spect_data <span class="op">=</span> read_file(path)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        spectra.append(spect_data[<span class="st">"AB"</span>])</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        names.append(path.stem)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>wave_nums <span class="op">=</span> spect_data.get_range()</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>column_names1 <span class="op">=</span> [<span class="st">'</span><span class="sc">{:.0f}</span><span class="st">'</span>.<span class="bu">format</span>(x) <span class="cf">for</span> x <span class="kw">in</span> wave_nums]</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>ZnSe_df <span class="op">=</span> pd.DataFrame(spectra, index<span class="op">=</span>names, columns<span class="op">=</span>column_names1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0
Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`
  for path in tqdm(AFSIS_PATH.glob(ZnSe_SPECTRA_DIR )):</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"30a2b1904971453e88734bb589e7bbd6","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ZnSe_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">3996</th>
<th data-quarto-table-cell-role="th">3994</th>
<th data-quarto-table-cell-role="th">3992</th>
<th data-quarto-table-cell-role="th">3990</th>
<th data-quarto-table-cell-role="th">3988</th>
<th data-quarto-table-cell-role="th">3986</th>
<th data-quarto-table-cell-role="th">3984</th>
<th data-quarto-table-cell-role="th">3982</th>
<th data-quarto-table-cell-role="th">3980</th>
<th data-quarto-table-cell-role="th">3978</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">518</th>
<th data-quarto-table-cell-role="th">516</th>
<th data-quarto-table-cell-role="th">514</th>
<th data-quarto-table-cell-role="th">512</th>
<th data-quarto-table-cell-role="th">510</th>
<th data-quarto-table-cell-role="th">508</th>
<th data-quarto-table-cell-role="th">506</th>
<th data-quarto-table-cell-role="th">504</th>
<th data-quarto-table-cell-role="th">502</th>
<th data-quarto-table-cell-role="th">500</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr033603</td>
<td>1.336817</td>
<td>1.337777</td>
<td>1.338591</td>
<td>1.339180</td>
<td>1.339602</td>
<td>1.339999</td>
<td>1.340485</td>
<td>1.341091</td>
<td>1.341770</td>
<td>1.342445</td>
<td>...</td>
<td>2.274969</td>
<td>2.276752</td>
<td>2.252275</td>
<td>2.223028</td>
<td>2.210677</td>
<td>2.225878</td>
<td>2.251971</td>
<td>2.209258</td>
<td>2.221467</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">icr042897</td>
<td>1.217690</td>
<td>1.218229</td>
<td>1.218768</td>
<td>1.219244</td>
<td>1.219670</td>
<td>1.220118</td>
<td>1.220660</td>
<td>1.221307</td>
<td>1.221991</td>
<td>1.222615</td>
<td>...</td>
<td>2.221671</td>
<td>2.189322</td>
<td>2.175592</td>
<td>2.185125</td>
<td>2.209400</td>
<td>2.227240</td>
<td>2.216305</td>
<td>2.164982</td>
<td>2.129341</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr049675</td>
<td>1.155588</td>
<td>1.155937</td>
<td>1.156262</td>
<td>1.156588</td>
<td>1.156925</td>
<td>1.157270</td>
<td>1.157606</td>
<td>1.157913</td>
<td>1.158161</td>
<td>1.158312</td>
<td>...</td>
<td>2.400493</td>
<td>2.362777</td>
<td>2.327363</td>
<td>2.304740</td>
<td>2.297083</td>
<td>2.296757</td>
<td>2.288914</td>
<td>2.260693</td>
<td>2.206604</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">icr034693</td>
<td>1.215348</td>
<td>1.215774</td>
<td>1.216170</td>
<td>1.216544</td>
<td>1.216940</td>
<td>1.217407</td>
<td>1.217960</td>
<td>1.218564</td>
<td>1.219142</td>
<td>1.219622</td>
<td>...</td>
<td>2.146795</td>
<td>2.123838</td>
<td>2.091934</td>
<td>2.052702</td>
<td>2.009385</td>
<td>1.963674</td>
<td>1.915830</td>
<td>1.866890</td>
<td>1.819085</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">icr033950</td>
<td>1.163011</td>
<td>1.163466</td>
<td>1.163930</td>
<td>1.164330</td>
<td>1.164612</td>
<td>1.164770</td>
<td>1.164867</td>
<td>1.165003</td>
<td>1.165248</td>
<td>1.165577</td>
<td>...</td>
<td>2.140887</td>
<td>2.131997</td>
<td>2.106665</td>
<td>2.065614</td>
<td>2.013958</td>
<td>1.957800</td>
<td>1.904114</td>
<td>1.861121</td>
<td>1.835173</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 1716 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># - table with FTIR spectra for each sample</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>df_ZnSe_FTIRspectra <span class="op">=</span> ZnSe_df.T.reset_index()</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>df_ZnSe_FTIRspectra <span class="op">=</span> df_ZnSe_FTIRspectra.rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'labda'</span>})</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>df_ZnSe_FTIRspectra.labda <span class="op">=</span> pd.to_numeric(df_ZnSe_FTIRspectra.labda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"spectral range:"</span>, df_ZnSe_FTIRspectra.labda.<span class="bu">min</span>(), <span class="st">"cm-1 - "</span>,df_ZnSe_FTIRspectra.labda.<span class="bu">max</span>(), <span class="st">"cm-1"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spectral range: 500 cm-1 -  3996 cm-1</code></pre>
</div>
</div>
</section>
<section id="tensor-27-hts-xt-spectrometer" class="level5">
<h5 class="anchored" data-anchor-id="tensor-27-hts-xt-spectrometer">- Tensor 27 HTS-XT spectrometer</h5>
<p>KBr window and wider range: both MID and Near IR</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>HTSXT_SPECTRA_DIR <span class="op">=</span> <span class="st">'Bruker_HTSXT/*'</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>AFSIS_PATH <span class="op">=</span> Path(<span class="st">'afsis/2009-2013/Dry_Chemistry/ICRAF'</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> []</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>spectra <span class="op">=</span> []</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> tqdm(AFSIS_PATH.glob(HTSXT_SPECTRA_DIR )):</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> path.is_file():</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>        spect_data <span class="op">=</span> read_file(path)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>        spectra.append(spect_data[<span class="st">"AB"</span>])</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>        names.append(path.stem)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>wave_nums <span class="op">=</span> spect_data.get_range()</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>column_names <span class="op">=</span> [<span class="st">'</span><span class="sc">{:.0f}</span><span class="st">'</span>.<span class="bu">format</span>(x) <span class="cf">for</span> x <span class="kw">in</span> wave_nums]</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>htsxt_df <span class="op">=</span> pd.DataFrame(spectra, index<span class="op">=</span>names, columns<span class="op">=</span>column_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0
Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`
  for path in tqdm(AFSIS_PATH.glob(HTSXT_SPECTRA_DIR )):</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"83b0824576264c8e9ca530a7a2eaf5c3","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Total measurements'</span>,<span class="bu">len</span>(htsxt_df.index),<span class="st">', unique samples'</span>, <span class="bu">len</span>(htsxt_df.index.unique()) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total measurements 7346 , unique samples 1839</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table with FTIR spectra for each sample</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>df_htsxt_FTIRspectra <span class="op">=</span> htsxt_df.T.reset_index()</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>df_htsxt_FTIRspectra <span class="op">=</span> df_htsxt_FTIRspectra.rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'labda'</span>})</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>df_htsxt_FTIRspectra.labda <span class="op">=</span> pd.to_numeric(df_htsxt_FTIRspectra.labda)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"spectral range:"</span>, df_htsxt_FTIRspectra.labda.<span class="bu">min</span>(), <span class="st">"cm-1 - "</span>,df_htsxt_FTIRspectra.labda.<span class="bu">max</span>(), <span class="st">"cm-1"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spectral range: 600 cm-1 -  7498 cm-1</code></pre>
</div>
</div>
<p>Are Tensor 27 HTS-XT spectrometer measurements reproducible?</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plt.plot(df_htsxt_FTIRspectra[<span class="st">'labda'</span>],df_htsxt_FTIRspectra[<span class="st">'icr034794'</span>], label <span class="op">=</span> <span class="st">'HTSXT'</span>) </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Example same sample repetitions - HTSXT'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">7500</span>,<span class="dv">400</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Absorbance (A.U.)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Wavelengths (cm-1)'</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'4 repetitions, identical result'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4 repetitions, identical result</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="afsis-soil-chem-EDA_files/figure-html/cell-30-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>let’s average the repetitions</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>htsxt_df <span class="op">=</span> htsxt_df.reset_index()</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>htsxt_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">7498</th>
<th data-quarto-table-cell-role="th">7496</th>
<th data-quarto-table-cell-role="th">7494</th>
<th data-quarto-table-cell-role="th">7492</th>
<th data-quarto-table-cell-role="th">7490</th>
<th data-quarto-table-cell-role="th">7488</th>
<th data-quarto-table-cell-role="th">7486</th>
<th data-quarto-table-cell-role="th">7485</th>
<th data-quarto-table-cell-role="th">7483</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">617</th>
<th data-quarto-table-cell-role="th">615</th>
<th data-quarto-table-cell-role="th">613</th>
<th data-quarto-table-cell-role="th">611</th>
<th data-quarto-table-cell-role="th">609</th>
<th data-quarto-table-cell-role="th">607</th>
<th data-quarto-table-cell-role="th">606</th>
<th data-quarto-table-cell-role="th">604</th>
<th data-quarto-table-cell-role="th">602</th>
<th data-quarto-table-cell-role="th">600</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>icr033603</td>
<td>0.363767</td>
<td>0.358597</td>
<td>0.352962</td>
<td>0.355229</td>
<td>0.364906</td>
<td>0.370382</td>
<td>0.363909</td>
<td>0.354324</td>
<td>0.350436</td>
<td>...</td>
<td>1.903912</td>
<td>1.892159</td>
<td>1.883104</td>
<td>1.875069</td>
<td>1.863860</td>
<td>1.846478</td>
<td>1.827501</td>
<td>1.811521</td>
<td>1.798762</td>
<td>1.785432</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>icr010356</td>
<td>0.138930</td>
<td>0.132892</td>
<td>0.136494</td>
<td>0.148280</td>
<td>0.153970</td>
<td>0.145607</td>
<td>0.134926</td>
<td>0.131624</td>
<td>0.130996</td>
<td>...</td>
<td>1.799327</td>
<td>1.789603</td>
<td>1.779350</td>
<td>1.767130</td>
<td>1.751588</td>
<td>1.736565</td>
<td>1.723430</td>
<td>1.712572</td>
<td>1.705888</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>icr055782</td>
<td>0.198082</td>
<td>0.193039</td>
<td>0.187723</td>
<td>0.190430</td>
<td>0.200350</td>
<td>0.205885</td>
<td>0.199621</td>
<td>0.190752</td>
<td>0.188001</td>
<td>...</td>
<td>1.612597</td>
<td>1.624695</td>
<td>1.637514</td>
<td>1.644494</td>
<td>1.651400</td>
<td>1.663048</td>
<td>1.675583</td>
<td>1.689286</td>
<td>1.701757</td>
<td>1.708080</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>icr011264</td>
<td>0.327606</td>
<td>0.321836</td>
<td>0.325163</td>
<td>0.336058</td>
<td>0.341134</td>
<td>0.332636</td>
<td>0.321906</td>
<td>0.318676</td>
<td>0.317745</td>
<td>...</td>
<td>1.875749</td>
<td>1.869287</td>
<td>1.868335</td>
<td>1.877906</td>
<td>1.887795</td>
<td>1.885020</td>
<td>1.873055</td>
<td>1.863219</td>
<td>1.855847</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>icr034402</td>
<td>0.339334</td>
<td>0.334438</td>
<td>0.329383</td>
<td>0.331227</td>
<td>0.339271</td>
<td>0.343485</td>
<td>0.337471</td>
<td>0.329251</td>
<td>0.326680</td>
<td>...</td>
<td>1.491697</td>
<td>1.492001</td>
<td>1.491628</td>
<td>1.489214</td>
<td>1.486117</td>
<td>1.482170</td>
<td>1.478855</td>
<td>1.479840</td>
<td>1.483233</td>
<td>1.483134</td>
</tr>
</tbody>
</table>

<p>5 rows × 3579 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>htsxt_df <span class="op">=</span> htsxt_df.rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'SSN'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>gb_htsxt <span class="op">=</span> htsxt_df.groupby([<span class="st">'SSN'</span>]).mean().reset_index()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gb_htsxt.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1839, 3579)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>gb_htsxt <span class="op">=</span> gb_htsxt.set_index(<span class="st">'SSN'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>gb_htsxt_FTIRspectra <span class="op">=</span> gb_htsxt.T.reset_index()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>gb_htsxt_FTIRspectra <span class="op">=</span> gb_htsxt_FTIRspectra.rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'labda'</span>})</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>gb_htsxt_FTIRspectra.labda <span class="op">=</span> pd.to_numeric(gb_htsxt_FTIRspectra.labda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plt.plot(df_htsxt_FTIRspectra[<span class="st">'labda'</span>],df_htsxt_FTIRspectra[<span class="st">'icr034794'</span>], label <span class="op">=</span> <span class="st">'repetition'</span>) </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>plt.plot(gb_htsxt_FTIRspectra[<span class="st">'labda'</span>],gb_htsxt_FTIRspectra[<span class="st">'icr034794'</span>],color <span class="op">=</span> <span class="st">'k'</span>, label <span class="op">=</span> <span class="st">'average'</span>) </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Same sample repetitions and average'</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">7500</span>,<span class="dv">400</span>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Absorbance (A.U.)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Wavelengths (cm-1)'</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'4 repetitions, identical result'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4 repetitions, identical result</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="afsis-soil-chem-EDA_files/figure-html/cell-36-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'what is the difference between different spectrometers measurements?'</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span> (<span class="dv">6</span>,<span class="dv">6</span>))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>plt.plot(df_KBR_FTIRspectra[<span class="st">'labda'</span>],df_KBR_FTIRspectra[<span class="st">'icr042897'</span>], label <span class="op">=</span> <span class="st">'Kbr'</span>) </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>plt.plot(df_ZnSe_FTIRspectra[<span class="st">'labda'</span>],df_ZnSe_FTIRspectra[<span class="st">'icr042897'</span>], label <span class="op">=</span> <span class="st">'ZnSe'</span>) </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>plt.plot(gb_htsxt_FTIRspectra[<span class="st">'labda'</span>],gb_htsxt_FTIRspectra[<span class="st">'icr042897'</span>], label <span class="op">=</span> <span class="st">'HTSXT'</span>) </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Example different spectrometers'</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">4000</span>,<span class="dv">400</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Absorbance (A.U.)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Wavelengths (cm-1)'</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>what is the difference between different spectrometers measurements?</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>Text(0.5, 0, 'Wavelengths (cm-1)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="afsis-soil-chem-EDA_files/figure-html/cell-37-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_KBR_FTIRspectra.shape)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>df_KBR_FTIRspectra.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(2542, 1889)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">labda</th>
<th data-quarto-table-cell-role="th">icr033603</th>
<th data-quarto-table-cell-role="th">icr042897</th>
<th data-quarto-table-cell-role="th">icr049675</th>
<th data-quarto-table-cell-role="th">icr034693</th>
<th data-quarto-table-cell-role="th">icr033950</th>
<th data-quarto-table-cell-role="th">icr034794</th>
<th data-quarto-table-cell-role="th">icr015953</th>
<th data-quarto-table-cell-role="th">icr050394</th>
<th data-quarto-table-cell-role="th">icr048771</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">icr011182</th>
<th data-quarto-table-cell-role="th">icr073540</th>
<th data-quarto-table-cell-role="th">icr049437</th>
<th data-quarto-table-cell-role="th">icr037699</th>
<th data-quarto-table-cell-role="th">icr056181</th>
<th data-quarto-table-cell-role="th">icr055563</th>
<th data-quarto-table-cell-role="th">icr010159</th>
<th data-quarto-table-cell-role="th">icr074792</th>
<th data-quarto-table-cell-role="th">icr011321</th>
<th data-quarto-table-cell-role="th">icr062275</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3998</td>
<td>0.908592</td>
<td>0.810133</td>
<td>0.711836</td>
<td>0.788686</td>
<td>0.752478</td>
<td>0.799947</td>
<td>0.819920</td>
<td>0.701762</td>
<td>0.854325</td>
<td>...</td>
<td>0.741123</td>
<td>0.707601</td>
<td>0.735885</td>
<td>0.792272</td>
<td>0.784010</td>
<td>0.675416</td>
<td>0.859956</td>
<td>0.675066</td>
<td>0.807336</td>
<td>0.753118</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3997</td>
<td>0.908981</td>
<td>0.809940</td>
<td>0.712355</td>
<td>0.789201</td>
<td>0.753251</td>
<td>0.801083</td>
<td>0.819910</td>
<td>0.702142</td>
<td>0.854623</td>
<td>...</td>
<td>0.741535</td>
<td>0.707462</td>
<td>0.735881</td>
<td>0.793356</td>
<td>0.784840</td>
<td>0.675505</td>
<td>0.859586</td>
<td>0.675193</td>
<td>0.807802</td>
<td>0.753273</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3996</td>
<td>0.909435</td>
<td>0.809745</td>
<td>0.713021</td>
<td>0.789494</td>
<td>0.753915</td>
<td>0.802259</td>
<td>0.820077</td>
<td>0.702510</td>
<td>0.854676</td>
<td>...</td>
<td>0.741678</td>
<td>0.707289</td>
<td>0.735951</td>
<td>0.794496</td>
<td>0.785365</td>
<td>0.675546</td>
<td>0.859557</td>
<td>0.675159</td>
<td>0.808202</td>
<td>0.753584</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3994</td>
<td>0.909956</td>
<td>0.809616</td>
<td>0.713747</td>
<td>0.789611</td>
<td>0.754423</td>
<td>0.803318</td>
<td>0.820496</td>
<td>0.702824</td>
<td>0.854543</td>
<td>...</td>
<td>0.741524</td>
<td>0.707115</td>
<td>0.736090</td>
<td>0.795609</td>
<td>0.785554</td>
<td>0.675588</td>
<td>0.859890</td>
<td>0.674942</td>
<td>0.808552</td>
<td>0.754089</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3993</td>
<td>0.910562</td>
<td>0.809566</td>
<td>0.714438</td>
<td>0.789634</td>
<td>0.754733</td>
<td>0.804114</td>
<td>0.821235</td>
<td>0.703081</td>
<td>0.854348</td>
<td>...</td>
<td>0.741103</td>
<td>0.706966</td>
<td>0.736295</td>
<td>0.796670</td>
<td>0.785448</td>
<td>0.675682</td>
<td>0.860528</td>
<td>0.674554</td>
<td>0.808865</td>
<td>0.754796</td>
</tr>
</tbody>
</table>

<p>5 rows × 1889 columns</p>
</div>
</div>
</div>
</section>
<section id="build-unique-dataset-for-ftir" class="level5">
<h5 class="anchored" data-anchor-id="build-unique-dataset-for-ftir">- build unique dataset for FTIR</h5>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>KBr_list <span class="op">=</span> kbr_df.index.tolist()</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>ZnSe_list <span class="op">=</span> ZnSe_df.index.tolist()</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>HTSXT_list <span class="op">=</span> gb_htsxt.index.tolist()</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'samples tested with alpha-KBr'</span>, <span class="bu">len</span>(KBr_list))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'samples tested with alpha-ZnSe'</span>, <span class="bu">len</span>(ZnSe_list))</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'samples tested with Tensor27'</span>, <span class="bu">len</span>(HTSXT_list))</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"difference samples alpha spectrometers:"</span>,<span class="bu">len</span>(KBr_list) <span class="op">-</span> <span class="bu">len</span>(ZnSe_list))</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="st">"difference samples alpha_kbr to tensor27 spectrometers:"</span>, <span class="bu">len</span>(KBr_list) <span class="op">-</span> <span class="bu">len</span>(HTSXT_list))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>samples tested with alpha-KBr 1888
samples tested with alpha-ZnSe 1835
samples tested with Tensor27 1839
difference samples alpha spectrometers: 53
difference samples alpha_kbr to tensor27 spectrometers: 49</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>diff_list1 <span class="op">=</span> np.setdiff1d(KBr_list,ZnSe_list)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"samples tested using the Alpha-KBr and not the Alpha-ZnSe spectrometer"</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(diff_list1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>samples tested using the Alpha-KBr and not the Alpha-ZnSe spectrometer
53</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>diff_list_KBr <span class="op">=</span> np.setdiff1d(HTSXT_list, KBr_list)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"samples tested using the Tensor27 and not the Alpha-KBr spectrometer"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(diff_list_KBr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>samples tested using the Tensor27 and not the Alpha-KBr spectrometer
8</code></pre>
</div>
</div>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>mask_diff_kbr <span class="op">=</span> kbr_df[kbr_df.index.isin(diff_list )]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>mask_diff_znse <span class="op">=</span> ZnSe_df[ZnSe_df.index.isin(diff_list )]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>mask_diff_htsxt <span class="op">=</span> gb_htsxt[gb_htsxt.index.isin(diff_list )]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'KBr'</span>,<span class="bu">len</span>(mask_diff_kbr.index) ,<span class="st">'ZnSe'</span>, <span class="bu">len</span>(mask_diff_znse.index), <span class="st">'HTSXT'</span>, <span class="bu">len</span>(mask_diff_htsxt.index))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>KBr 1616 ZnSe 1616 HTSXT 1615</code></pre>
</div>
</div>
<ul>
<li>Most information from Alpha spectrometers and MPA is redundant. Tensor27 NIR peaks provide the same information for both MID and Near IR range</li>
</ul>
</section>
</section>
</section>
</section>
<section id="wet-chemistry" class="level2">
<h2 class="anchored" data-anchor-id="wet-chemistry">4. Wet chemistry</h2>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>WET_CHEM_PATH1 <span class="op">=</span> <span class="st">'afsis/2009-2013/Wet_Chemistry/CROPNUTS/Wet_Chemistry_CROPNUTS.csv'</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>wet_chem_df <span class="op">=</span> pd.read_csv(WET_CHEM_PATH1)<span class="co">#, usecols=columns_to_load)</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>elements <span class="op">=</span> [<span class="st">'SSN'</span>,<span class="st">'M3 Ca'</span>, <span class="st">'M3 K'</span>, <span class="st">'M3 Al'</span>, <span class="st">'M3 P'</span>, <span class="st">'M3 S'</span>, <span class="st">'PH'</span>]</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>wet_chem_df <span class="op">=</span> wet_chem_df[elements]</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(wet_chem_df.shape)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>wet_chem_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1907, 7)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SSN</th>
<th data-quarto-table-cell-role="th">M3 Ca</th>
<th data-quarto-table-cell-role="th">M3 K</th>
<th data-quarto-table-cell-role="th">M3 Al</th>
<th data-quarto-table-cell-role="th">M3 P</th>
<th data-quarto-table-cell-role="th">M3 S</th>
<th data-quarto-table-cell-role="th">PH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>icr006475</td>
<td>207.1</td>
<td>306.30</td>
<td>1095.0</td>
<td>4.495</td>
<td>18.960</td>
<td>4.682</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>icr006586</td>
<td>1665.0</td>
<td>1186.00</td>
<td>1165.0</td>
<td>12.510</td>
<td>13.600</td>
<td>7.062</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>icr007929</td>
<td>2518.0</td>
<td>72.57</td>
<td>727.6</td>
<td>21.090</td>
<td>14.810</td>
<td>7.114</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>icr008008</td>
<td>734.3</td>
<td>274.60</td>
<td>1458.0</td>
<td>109.200</td>
<td>11.400</td>
<td>5.650</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>icr010198</td>
<td>261.8</td>
<td>91.76</td>
<td>2166.0</td>
<td>3.958</td>
<td>5.281</td>
<td>5.501</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>WET_CHEM_PATH2 <span class="op">=</span> <span class="st">'afsis/2009-2013/Wet_Chemistry/RRES/Wet_Chemistry_RRES.csv'</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co">#columns_to_load = elements + ['SSN']</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>wet_chem_df1 <span class="op">=</span> pd.read_csv(WET_CHEM_PATH2)<span class="co">#, usecols=columns_to_load)</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>elements <span class="op">=</span> [<span class="st">'SSN'</span>,<span class="st">'pH'</span>, <span class="st">'%N'</span>, <span class="st">'C % Org'</span>, <span class="st">'ICP OES K mg/kg '</span>, <span class="st">'ICP OES P mg/kg '</span>]</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>wet_chem_df1 <span class="op">=</span> wet_chem_df1[elements]</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>wet_chem_df1 <span class="op">=</span> wet_chem_df1.rename(columns<span class="op">=</span>{<span class="st">"%N"</span>: <span class="st">"Leco_N_ppm"</span>})</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>wet_chem_df1[<span class="st">'Leco_N_ppm'</span>] <span class="op">=</span> wet_chem_df1[<span class="st">'Leco_N_ppm'</span>]<span class="op">*</span><span class="dv">10000</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(wet_chem_df1.columns)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>wet_chem_df1.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['SSN', 'pH', 'Leco_N_ppm', 'C % Org', 'ICP OES K mg/kg ',
       'ICP OES P mg/kg '],
      dtype='object')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="134">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SSN</th>
<th data-quarto-table-cell-role="th">pH</th>
<th data-quarto-table-cell-role="th">Leco_N_ppm</th>
<th data-quarto-table-cell-role="th">C % Org</th>
<th data-quarto-table-cell-role="th">ICP OES K mg/kg</th>
<th data-quarto-table-cell-role="th">ICP OES P mg/kg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>icr006454</td>
<td>7.85</td>
<td>800.0</td>
<td>0.94</td>
<td>8517.919223</td>
<td>96.575131</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>icr006455</td>
<td>8.03</td>
<td>600.0</td>
<td>0.70</td>
<td>10859.303780</td>
<td>117.423139</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>icr006474</td>
<td>5.01</td>
<td>500.0</td>
<td>0.57</td>
<td>1343.124117</td>
<td>87.040073</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>icr006475</td>
<td>4.57</td>
<td>500.0</td>
<td>0.47</td>
<td>1487.768795</td>
<td>83.555482</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>icr006492</td>
<td>6.78</td>
<td>900.0</td>
<td>0.98</td>
<td>2999.240760</td>
<td>150.936463</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>WET_CHEM_PATH3 <span class="op">=</span> <span class="st">'afsis/2009-2013/Wet_Chemistry/ICRAF/Wet_Chemistry_ICRAF.csv'</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co">#elements = ['M3 Ca', 'M3 K', 'M3 Al']</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">#columns_to_load = elements + ['SSN']</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>wet_chem_df2 <span class="op">=</span> pd.read_csv(WET_CHEM_PATH3)<span class="co">#, usecols=columns_to_load)</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co">#print(wet_chem_df2.columns)</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>elements <span class="op">=</span> [<span class="st">'SSN'</span>,<span class="st">'Psa asand'</span>, <span class="st">'Psa asilt'</span>,<span class="st">'Psa aclay'</span>, <span class="st">'Volfr'</span>, <span class="st">'Awc1'</span>,<span class="st">'Lshrinkpct'</span>, <span class="st">'Acidified nitrogen'</span>,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Acidified carbon'</span>]</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>wet_chem_df2 <span class="op">=</span> wet_chem_df2[elements]</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>wet_chem_df2[<span class="st">'Acidified nitrogen'</span>] <span class="op">=</span> wet_chem_df2[<span class="st">'Acidified nitrogen'</span>]<span class="op">*</span><span class="dv">10000</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>wet_chem_df2 <span class="op">=</span> wet_chem_df2.rename(columns<span class="op">=</span>{<span class="st">"Acidified nitrogen"</span>: <span class="st">"Flash2000_N_ppm"</span>})</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(wet_chem_df2.shape)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>wet_chem_df2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1907, 9)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="139">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SSN</th>
<th data-quarto-table-cell-role="th">Psa asand</th>
<th data-quarto-table-cell-role="th">Psa asilt</th>
<th data-quarto-table-cell-role="th">Psa aclay</th>
<th data-quarto-table-cell-role="th">Volfr</th>
<th data-quarto-table-cell-role="th">Awc1</th>
<th data-quarto-table-cell-role="th">Lshrinkpct</th>
<th data-quarto-table-cell-role="th">Flash2000_N_ppm</th>
<th data-quarto-table-cell-role="th">Acidified carbon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>icr005928</td>
<td>90.993000</td>
<td>8.111667</td>
<td>0.896333</td>
<td>1.190000</td>
<td>0.070768</td>
<td>0.000000</td>
<td>296.21345</td>
<td>0.425854</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>icr005929</td>
<td>87.847000</td>
<td>11.416000</td>
<td>0.737000</td>
<td>1.192000</td>
<td>0.061710</td>
<td>5.000000</td>
<td>230.68986</td>
<td>0.263235</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>icr005946</td>
<td>94.408333</td>
<td>5.335333</td>
<td>0.256000</td>
<td>1.171280</td>
<td>0.115414</td>
<td>5.714286</td>
<td>313.39549</td>
<td>0.392983</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>icr005947</td>
<td>94.601333</td>
<td>5.239333</td>
<td>0.159000</td>
<td>1.198744</td>
<td>0.122856</td>
<td>0.000000</td>
<td>170.62043</td>
<td>0.233496</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>icr005965</td>
<td>90.015333</td>
<td>9.195667</td>
<td>0.789000</td>
<td>1.081575</td>
<td>0.100874</td>
<td>5.000000</td>
<td>831.45402</td>
<td>0.860801</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="join-and-clean-datasets" class="level2">
<h2 class="anchored" data-anchor-id="join-and-clean-datasets">5. Join and clean datasets</h2>
<section id="elemental-analysis" class="level4">
<h4 class="anchored" data-anchor-id="elemental-analysis">5.1 Elemental analysis</h4>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df_elements1 <span class="op">=</span> pd.merge(left<span class="op">=</span>wet_chem_df1, right<span class="op">=</span>df_xrf_reduced, left_on<span class="op">=</span><span class="st">'SSN'</span>, right_on<span class="op">=</span><span class="st">'SSN'</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_elements1.shape)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>df_elements2 <span class="op">=</span> pd.merge(left<span class="op">=</span>wet_chem_df2, right<span class="op">=</span>df_elements1, left_on<span class="op">=</span><span class="st">'SSN'</span>, right_on<span class="op">=</span><span class="st">'SSN'</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_elements2.shape)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>df_elements <span class="op">=</span> pd.merge(left<span class="op">=</span>wet_chem_df, right<span class="op">=</span>df_elements2, left_on<span class="op">=</span><span class="st">'SSN'</span>, right_on<span class="op">=</span><span class="st">'SSN'</span>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_elements.shape)</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_elements.columns)</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>df_elements.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(467, 17)
(467, 25)
(467, 31)
Index(['SSN', 'M3 Ca', 'M3 K', 'M3 Al', 'M3 P', 'M3 S', 'PH', 'Psa asand',
       'Psa asilt', 'Psa aclay', 'Volfr', 'Awc1', 'Lshrinkpct',
       'Flash2000_N_ppm', 'Acidified carbon', 'pH', 'Leco_N_ppm', 'C % Org',
       'ICP OES K mg/kg ', 'ICP OES P mg/kg ', 'P', 'K', 'S', 'Ca', 'Mg', 'Cu',
       'Cl', 'Zn', 'Fe', 'Mn', 'Mo'],
      dtype='object')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="140">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SSN</th>
<th data-quarto-table-cell-role="th">M3 Ca</th>
<th data-quarto-table-cell-role="th">M3 K</th>
<th data-quarto-table-cell-role="th">M3 Al</th>
<th data-quarto-table-cell-role="th">M3 P</th>
<th data-quarto-table-cell-role="th">M3 S</th>
<th data-quarto-table-cell-role="th">PH</th>
<th data-quarto-table-cell-role="th">Psa asand</th>
<th data-quarto-table-cell-role="th">Psa asilt</th>
<th data-quarto-table-cell-role="th">Psa aclay</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">K</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">Ca</th>
<th data-quarto-table-cell-role="th">Mg</th>
<th data-quarto-table-cell-role="th">Cu</th>
<th data-quarto-table-cell-role="th">Cl</th>
<th data-quarto-table-cell-role="th">Zn</th>
<th data-quarto-table-cell-role="th">Fe</th>
<th data-quarto-table-cell-role="th">Mn</th>
<th data-quarto-table-cell-role="th">Mo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>icr006475</td>
<td>207.1</td>
<td>306.30</td>
<td>1095.000</td>
<td>4.495</td>
<td>18.960</td>
<td>4.682</td>
<td>97.848667</td>
<td>1.845333</td>
<td>0.306000</td>
<td>...</td>
<td>12991.3</td>
<td>45.7</td>
<td>944.1</td>
<td>5575.0</td>
<td>13.0</td>
<td>210.2</td>
<td>22.0</td>
<td>12501.3</td>
<td>81.9</td>
<td>184.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>icr006586</td>
<td>1665.0</td>
<td>1186.00</td>
<td>1165.000</td>
<td>12.510</td>
<td>13.600</td>
<td>7.062</td>
<td>89.520000</td>
<td>9.553667</td>
<td>0.926333</td>
<td>...</td>
<td>15173.5</td>
<td>45.7</td>
<td>9301.0</td>
<td>5519.1</td>
<td>18.4</td>
<td>152.6</td>
<td>38.5</td>
<td>24094.6</td>
<td>422.4</td>
<td>184.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>icr021104</td>
<td>258.7</td>
<td>35.25</td>
<td>441.400</td>
<td>4.424</td>
<td>3.608</td>
<td>5.522</td>
<td>89.950000</td>
<td>5.205000</td>
<td>4.845000</td>
<td>...</td>
<td>6838.9</td>
<td>45.7</td>
<td>884.3</td>
<td>5575.0</td>
<td>2.8</td>
<td>229.5</td>
<td>2.3</td>
<td>2213.4</td>
<td>13.2</td>
<td>184.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>icr033622</td>
<td>11858.3</td>
<td>1156.00</td>
<td>108.286</td>
<td>31.233</td>
<td>25.460</td>
<td>8.583</td>
<td>91.445000</td>
<td>6.310000</td>
<td>2.245000</td>
<td>...</td>
<td>15845.8</td>
<td>45.7</td>
<td>46529.1</td>
<td>33771.2</td>
<td>13.0</td>
<td>58.2</td>
<td>29.8</td>
<td>24135.0</td>
<td>460.4</td>
<td>184.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>icr006570</td>
<td>896.2</td>
<td>607.30</td>
<td>1151.000</td>
<td>5.986</td>
<td>20.080</td>
<td>6.661</td>
<td>97.789667</td>
<td>1.885000</td>
<td>0.325667</td>
<td>...</td>
<td>12201.6</td>
<td>45.7</td>
<td>1790.1</td>
<td>5575.0</td>
<td>7.7</td>
<td>122.5</td>
<td>13.4</td>
<td>9135.1</td>
<td>132.6</td>
<td>184.5</td>
</tr>
</tbody>
</table>

<p>5 rows × 31 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="141">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check for possible negative values</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df_elements.columns.tolist()[<span class="dv">1</span>:]:</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df_elements[col].dtype <span class="op">==</span> np.float64:</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>         df_elements[col][df_elements[col] <span class="op">&lt;</span> <span class="dv">0</span>] <span class="op">=</span>np.nan</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_elements.isna().<span class="bu">sum</span>().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>54</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_elements[col][df_elements[col] &lt; 0] =np.nan</code></pre>
</div>
</div>
</section>
<section id="merge-geographical-and-chemical-data" class="level4">
<h4 class="anchored" data-anchor-id="merge-geographical-and-chemical-data">merge geographical and chemical data</h4>
<div class="cell" data-execution_count="142">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df_geoelements <span class="op">=</span> pd.merge(left<span class="op">=</span>df_elements, right<span class="op">=</span>df_geo, left_on<span class="op">=</span><span class="st">'SSN'</span>, right_on<span class="op">=</span><span class="st">'SSN'</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_geoelements.shape)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_geoelements.columns)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>df_geoelements.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(467, 37)
Index(['SSN', 'M3 Ca', 'M3 K', 'M3 Al', 'M3 P', 'M3 S', 'PH', 'Psa asand',
       'Psa asilt', 'Psa aclay', 'Volfr', 'Awc1', 'Lshrinkpct',
       'Flash2000_N_ppm', 'Acidified carbon', 'pH', 'Leco_N_ppm', 'C % Org',
       'ICP OES K mg/kg ', 'ICP OES P mg/kg ', 'P', 'K', 'S', 'Ca', 'Mg', 'Cu',
       'Cl', 'Zn', 'Fe', 'Mn', 'Mo', 'Latitude', 'Longitude', 'Cluster',
       'Depth', 'Country', 'Cultivated'],
      dtype='object')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="142">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SSN</th>
<th data-quarto-table-cell-role="th">M3 Ca</th>
<th data-quarto-table-cell-role="th">M3 K</th>
<th data-quarto-table-cell-role="th">M3 Al</th>
<th data-quarto-table-cell-role="th">M3 P</th>
<th data-quarto-table-cell-role="th">M3 S</th>
<th data-quarto-table-cell-role="th">PH</th>
<th data-quarto-table-cell-role="th">Psa asand</th>
<th data-quarto-table-cell-role="th">Psa asilt</th>
<th data-quarto-table-cell-role="th">Psa aclay</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Zn</th>
<th data-quarto-table-cell-role="th">Fe</th>
<th data-quarto-table-cell-role="th">Mn</th>
<th data-quarto-table-cell-role="th">Mo</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Cluster</th>
<th data-quarto-table-cell-role="th">Depth</th>
<th data-quarto-table-cell-role="th">Country</th>
<th data-quarto-table-cell-role="th">Cultivated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>icr006475</td>
<td>207.1</td>
<td>306.30</td>
<td>1095.000</td>
<td>4.495</td>
<td>18.960</td>
<td>4.682</td>
<td>97.848667</td>
<td>1.845333</td>
<td>0.306000</td>
<td>...</td>
<td>22.0</td>
<td>12501.3</td>
<td>81.9</td>
<td>184.5</td>
<td>-6.088750</td>
<td>36.435982</td>
<td>2</td>
<td>sub</td>
<td>Tanzania</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>icr006586</td>
<td>1665.0</td>
<td>1186.00</td>
<td>1165.000</td>
<td>12.510</td>
<td>13.600</td>
<td>7.062</td>
<td>89.520000</td>
<td>9.553667</td>
<td>0.926333</td>
<td>...</td>
<td>38.5</td>
<td>24094.6</td>
<td>422.4</td>
<td>184.5</td>
<td>-6.055750</td>
<td>36.457722</td>
<td>8</td>
<td>top</td>
<td>Tanzania</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>icr021104</td>
<td>258.7</td>
<td>35.25</td>
<td>441.400</td>
<td>4.424</td>
<td>3.608</td>
<td>5.522</td>
<td>89.950000</td>
<td>5.205000</td>
<td>4.845000</td>
<td>...</td>
<td>2.3</td>
<td>2213.4</td>
<td>13.2</td>
<td>184.5</td>
<td>-8.049305</td>
<td>37.333698</td>
<td>14</td>
<td>sub</td>
<td>Tanzania</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>icr033622</td>
<td>11858.3</td>
<td>1156.00</td>
<td>108.286</td>
<td>31.233</td>
<td>25.460</td>
<td>8.583</td>
<td>91.445000</td>
<td>6.310000</td>
<td>2.245000</td>
<td>...</td>
<td>29.8</td>
<td>24135.0</td>
<td>460.4</td>
<td>184.5</td>
<td>4.178087</td>
<td>38.261890</td>
<td>2</td>
<td>sub</td>
<td>Ethiopia</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>icr006570</td>
<td>896.2</td>
<td>607.30</td>
<td>1151.000</td>
<td>5.986</td>
<td>20.080</td>
<td>6.661</td>
<td>97.789667</td>
<td>1.885000</td>
<td>0.325667</td>
<td>...</td>
<td>13.4</td>
<td>9135.1</td>
<td>132.6</td>
<td>184.5</td>
<td>-6.069970</td>
<td>36.464588</td>
<td>7</td>
<td>top</td>
<td>Tanzania</td>
<td>False</td>
</tr>
</tbody>
</table>

<p>5 rows × 37 columns</p>
</div>
</div>
</div>
</section>
<section id="geographical-distribution-of-the-selected-samples" class="level4">
<h4 class="anchored" data-anchor-id="geographical-distribution-of-the-selected-samples">geographical distribution of the selected samples</h4>
<div class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>pd.value_counts(df_geoelements[<span class="st">'Country'</span>]).plot.bar(title<span class="op">=</span><span class="st">'Measurements per country'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="143">
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fd0c8193b20&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="afsis-soil-chem-EDA_files/figure-html/cell-49-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a> <span class="co">#Draw map</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>[<span class="op">-</span><span class="fl">3.5</span>, <span class="fl">35.6</span>], tiles<span class="op">=</span><span class="st">"stamentoner"</span>, zoom_start<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> df_geoelements.iterrows():</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> row[[<span class="st">'Latitude'</span>, <span class="st">'Longitude'</span>]].notnull().<span class="bu">all</span>():</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>        folium.Marker([row[<span class="st">'Latitude'</span>], </span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>                       row[<span class="st">'Longitude'</span>]], </span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>                      popup<span class="op">=</span>row[<span class="st">'SSN'</span>]</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>                     ).add_to(m)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="co">#m</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>Image(filename<span class="op">=</span><span class="st">'img/folium.png'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="144">
<p><img src="afsis-soil-chem-EDA_files/figure-html/cell-50-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="imputation-of-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="imputation-of-missing-values">imputation of missing values</h4>
<div class="cell" data-execution_count="157">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> replace_missings(data):</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this replaces missings with medians</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: mixed string num columns it does not do anything with</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cols <span class="kw">in</span> data._get_numeric_data().columns:</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>        data[cols].fillna(value<span class="op">=</span>data[cols].median(), inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>replace_missings(df_geoelements)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_geoelements[<span class="st">'Cultivated'</span>].unique())</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>df_geoelements[<span class="st">'Cultivated'</span>] <span class="op">=</span> df_geoelements[<span class="st">'Cultivated'</span>].fillna(<span class="st">'unknown'</span>)</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_geoelements[<span class="st">'Cultivated'</span>].unique())</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_geoelements.isna().<span class="bu">sum</span>().<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[False 'unknown' True]
[False 'unknown' True]
0</code></pre>
</div>
</div>
</section>
<section id="outliers" class="level4">
<h4 class="anchored" data-anchor-id="outliers">outliers</h4>
<div class="cell" data-execution_count="147">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> detect_outliers(df, n, features):</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Takes a dataframe df of features and returns a list of the indices</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding to the observations containing more than n outliers according</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co">    to the Tukey method.</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    outlier_indices <span class="op">=</span> []</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># iterate over features(columns)</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> features:</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 1st quartile (25%)</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>        Q1 <span class="op">=</span> np.percentile(df[col], <span class="dv">25</span>)</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 3rd quartile (75%)</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>        Q3 <span class="op">=</span> np.percentile(df[col], <span class="dv">75</span>)</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Interquartile range (IQR)</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>        IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># outlier step</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>        outlier_step <span class="op">=</span> <span class="dv">3</span> <span class="op">*</span> IQR</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determine a list of indices of outliers for feature col</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>        outlier_list_col <span class="op">=</span> df[(df[col] <span class="op">&lt;</span> Q1 <span class="op">-</span> outlier_step) <span class="op">|</span> (df[col] <span class="op">&gt;</span> Q3 <span class="op">+</span> outlier_step)].index</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># append the found outlier indices for col to the list of outlier indices </span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>        outlier_indices.extend(outlier_list_col)</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select observations containing more than 1 outlier</span></span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>    outlier_indices <span class="op">=</span> Counter(outlier_indices)        </span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> outlier_indices</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a><span class="co"># detect outliers from list of features</span></span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>lof <span class="op">=</span> [<span class="st">'M3 Ca'</span>, <span class="st">'M3 K'</span>, <span class="st">'M3 Al'</span>, <span class="st">'M3 P'</span>, <span class="st">'M3 S'</span>, <span class="st">'PH'</span>, <span class="st">'Psa asand'</span>,</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Psa asilt'</span>, <span class="st">'Psa aclay'</span>, <span class="st">'Volfr'</span>, <span class="st">'Awc1'</span>, <span class="st">'Lshrinkpct'</span>, <span class="st">'pH'</span>, <span class="st">'Flash2000_N_ppm'</span>,<span class="st">'Leco_N_ppm'</span>,</span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>       <span class="st">'C % Org'</span>, <span class="st">'ICP OES K mg/kg '</span>, <span class="st">'ICP OES P mg/kg '</span>, <span class="st">'P'</span>, <span class="st">'K'</span>, <span class="st">'S'</span>, <span class="st">'Ca'</span>,</span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Mg'</span>, <span class="st">'Cu'</span>, <span class="st">'Cl'</span>, <span class="st">'Zn'</span>, <span class="st">'Fe'</span>, <span class="st">'Mn'</span>, <span class="st">'Mo'</span>]<span class="co">#, </span></span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a>Outliers_to_drop <span class="op">=</span> detect_outliers(df_geoelements, <span class="dv">1</span>, lof)</span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(Outliers_to_drop), <span class="st">'outliers according to Tukey method'</span>)</span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(Outliers_to_drop)<span class="op">&gt;</span><span class="dv">50</span>:</span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'loss of information would be too high if Tukey method would be applied'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>209 outliers according to Tukey method
loss of information would be too high if Tukey method would be applied</code></pre>
</div>
</div>
<div class="cell" data-execution_count="148">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>df_chem <span class="op">=</span> df_geoelements[lof]</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>df_chem_scaled <span class="op">=</span>((df_chem <span class="op">-</span>df_chem.<span class="bu">min</span>())<span class="op">/</span>(df_chem.<span class="bu">max</span>()<span class="op">-</span>df_chem.<span class="bu">min</span>()))<span class="op">*</span><span class="dv">10</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span> (<span class="dv">22</span>,<span class="dv">6</span>))</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>box_plot_scaled <span class="op">=</span> sns.boxplot( data<span class="op">=</span> df_chem_scaled)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> box_plot_scaled.get_figure()</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Scaled values"</span>)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">"box.png"</span>, dpi<span class="op">=</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="afsis-soil-chem-EDA_files/figure-html/cell-53-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="150">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>df_chem.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="150">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">M3 Ca</th>
<th data-quarto-table-cell-role="th">M3 K</th>
<th data-quarto-table-cell-role="th">M3 Al</th>
<th data-quarto-table-cell-role="th">M3 P</th>
<th data-quarto-table-cell-role="th">M3 S</th>
<th data-quarto-table-cell-role="th">PH</th>
<th data-quarto-table-cell-role="th">Psa asand</th>
<th data-quarto-table-cell-role="th">Psa asilt</th>
<th data-quarto-table-cell-role="th">Psa aclay</th>
<th data-quarto-table-cell-role="th">Volfr</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">K</th>
<th data-quarto-table-cell-role="th">S</th>
<th data-quarto-table-cell-role="th">Ca</th>
<th data-quarto-table-cell-role="th">Mg</th>
<th data-quarto-table-cell-role="th">Cu</th>
<th data-quarto-table-cell-role="th">Cl</th>
<th data-quarto-table-cell-role="th">Zn</th>
<th data-quarto-table-cell-role="th">Fe</th>
<th data-quarto-table-cell-role="th">Mn</th>
<th data-quarto-table-cell-role="th">Mo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>...</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
<td>467.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>1605.142957</td>
<td>186.569448</td>
<td>802.767263</td>
<td>10.296321</td>
<td>23.906516</td>
<td>6.133593</td>
<td>84.902406</td>
<td>8.056587</td>
<td>7.041254</td>
<td>1.050843</td>
<td>...</td>
<td>11204.939829</td>
<td>77.834261</td>
<td>5092.092505</td>
<td>7004.122270</td>
<td>12.137473</td>
<td>190.165096</td>
<td>22.208351</td>
<td>22659.693362</td>
<td>316.650107</td>
<td>187.781370</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2780.256854</td>
<td>303.097846</td>
<td>423.564349</td>
<td>22.179751</td>
<td>154.640351</td>
<td>1.151291</td>
<td>14.436237</td>
<td>5.750215</td>
<td>9.775127</td>
<td>0.161490</td>
<td>...</td>
<td>13913.144061</td>
<td>467.413144</td>
<td>11339.284556</td>
<td>5675.704395</td>
<td>13.737260</td>
<td>1025.070888</td>
<td>25.877222</td>
<td>26454.053657</td>
<td>423.535962</td>
<td>48.287469</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.001000</td>
<td>5.110000</td>
<td>14.300000</td>
<td>0.001000</td>
<td>1.490000</td>
<td>4.000000</td>
<td>0.440000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.644500</td>
<td>...</td>
<td>90.400000</td>
<td>43.400000</td>
<td>69.700000</td>
<td>4032.600000</td>
<td>0.700000</td>
<td>19.700000</td>
<td>0.900000</td>
<td>729.900000</td>
<td>7.900000</td>
<td>184.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>236.800000</td>
<td>47.200000</td>
<td>446.543000</td>
<td>2.495000</td>
<td>4.732000</td>
<td>5.315000</td>
<td>83.500000</td>
<td>4.352500</td>
<td>2.375000</td>
<td>0.943500</td>
<td>...</td>
<td>1917.350000</td>
<td>45.700000</td>
<td>344.750000</td>
<td>5575.000000</td>
<td>3.900000</td>
<td>52.550000</td>
<td>6.600000</td>
<td>6575.600000</td>
<td>67.650000</td>
<td>184.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>560.700000</td>
<td>82.200000</td>
<td>735.486000</td>
<td>4.495000</td>
<td>7.530000</td>
<td>5.950000</td>
<td>88.525000</td>
<td>6.710000</td>
<td>4.595000</td>
<td>1.050500</td>
<td>...</td>
<td>5963.000000</td>
<td>45.700000</td>
<td>991.700000</td>
<td>5575.000000</td>
<td>8.000000</td>
<td>84.400000</td>
<td>15.200000</td>
<td>15149.100000</td>
<td>153.900000</td>
<td>184.500000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1375.400000</td>
<td>181.900000</td>
<td>1130.000000</td>
<td>8.590500</td>
<td>12.300000</td>
<td>6.603000</td>
<td>92.545000</td>
<td>9.607500</td>
<td>7.640000</td>
<td>1.180000</td>
<td>...</td>
<td>15435.750000</td>
<td>45.700000</td>
<td>3597.000000</td>
<td>5575.000000</td>
<td>15.100000</td>
<td>136.850000</td>
<td>28.550000</td>
<td>28039.050000</td>
<td>377.800000</td>
<td>184.500000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>18510.000000</td>
<td>3432.000000</td>
<td>2444.000000</td>
<td>221.800000</td>
<td>2728.860000</td>
<td>9.860000</td>
<td>100.005000</td>
<td>35.555000</td>
<td>81.400000</td>
<td>1.429500</td>
<td>...</td>
<td>106273.400000</td>
<td>9704.000000</td>
<td>89497.800000</td>
<td>51204.800000</td>
<td>110.300000</td>
<td>21557.400000</td>
<td>259.900000</td>
<td>222256.400000</td>
<td>3314.100000</td>
<td>1085.400000</td>
</tr>
</tbody>
</table>

<p>8 rows × 29 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># export to csv</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>df_geoelements.to_csv( <span class="st">'elemental_analysis_dataset.csv'</span>,index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ftir" class="level4">
<h4 class="anchored" data-anchor-id="ftir">5.2 FTIR</h4>
<div class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df_FTIR_reindexed <span class="op">=</span> df_KBR_FTIRspectra.set_index(<span class="st">'labda'</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>mid_infrared_df <span class="op">=</span> df_FTIR_reindexed.T.reset_index()</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>mid_infrared_df <span class="op">=</span> mid_infrared_df.rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'SSN'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="i-select-only-the-sample-that-are-in-the-compositional-dataframe-geoelements" class="level3">
<h3 class="anchored" data-anchor-id="i-select-only-the-sample-that-are-in-the-compositional-dataframe-geoelements">I select only the sample that are in the compositional dataframe “geoelements”</h3>
</section>
<section id="the-composition-and-ftir-dataframes-have-same-sample-numbers-ssn-column" class="level3">
<h3 class="anchored" data-anchor-id="the-composition-and-ftir-dataframes-have-same-sample-numbers-ssn-column">The composition and FTIR dataframes have same sample numbers (SSN) column</h3>
</section>
<section id="each-infrared-spectrum-corresponds-to-an-elemental-analysis" class="level3">
<h3 class="anchored" data-anchor-id="each-infrared-spectrum-corresponds-to-an-elemental-analysis">Each infrared spectrum corresponds to an elemental analysis</h3>
<div class="cell" data-execution_count="153">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>complete_measurements_list <span class="op">=</span> df_geoelements_reduced.SSN.tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>mid infrared</li>
</ul>
<div class="cell" data-execution_count="154">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>df_FTIRdata <span class="op">=</span> mid_infrared_df[mid_infrared_df.SSN.isin(complete_measurements_list)]</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_FTIRdata.shape)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co">#print(df_FTIRdata.isna().sum())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(467, 2543)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="155">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>df_FTIRdata.to_csv( <span class="st">'middle_infrared_spectra_dataset.csv'</span>,index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>near infrared</li>
</ul>
<div class="cell" data-execution_count="156">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>df_FTIR_reindexed1 <span class="op">=</span> df_NIR_FTIRspectra.set_index(<span class="st">'labda'</span>)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>near_infrared_df <span class="op">=</span> df_FTIR_reindexed1.T.reset_index()</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>near_infrared_df <span class="op">=</span> near_infrared_df.rename(columns<span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'SSN'</span>})</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># I select only the sample that are in the compositional dataframe "geoelements"</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>complete_measurements_list <span class="op">=</span> df_geoelements_reduced.SSN.tolist()</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>df_FTIRdataM <span class="op">=</span> near_infrared_df[near_infrared_df.SSN.isin(complete_measurements_list)]</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_FTIRdata.shape)</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="co">#print(df_FTIRdata.isna().sum())</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>df_FTIRdataM.to_csv( <span class="st">'near_infrared_spectra_dataset.csv'</span>,index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(467, 2543)</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.ilovesoils\.com\/**");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<script src="https://giscus.app/client.js" data-repo="Kkhurana007/fr_blog_mine" data-repo-id="R_kgDOJuKwyw" data-category="General" data-category-id="DIC_kwDOJuKwy84CXJ4P" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Blog made with <a href="https://quarto.org/">Quarto</a> by Kunal.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Kkhurana007">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/kunalkhurana007">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:Khuranasoilpau@gmail.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>